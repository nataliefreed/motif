{"mappings":"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","sources":["libraries/joy.js","src/scripts.js"],"sourcesContent":["/*****************\n\nJOY.js: make happy little programs\n\nVERSION 0 (the incredibly clunky first version) (sorry)\n\nCreated by Nicky Case http://ncase.me/\n\n*****************/\n\n// THE JOY MASTER\nfunction Joy(options){\n\n\t// You can call this as \"new Joy()\" or just \"Joy()\" \n\t// var self = (this==window) ? {} : this;\n\tvar self = {}; //NF changed with module import\n\n\t// Modules to import?\n\tif(options.modules){\n\t\tfor(var i=0;i<options.modules.length;i++){\n\t\t\tJoy.loadModule(options.modules[i]);\n\t\t}\n\t}\n\n\t// I'm a Joy.Actor!\n\tJoy.Actor.call(self, options);\n\n\t// Initialize References\n\tJoy.initReferences(self);\n\n\t// Allow previewing of... actions, numbers, variables?\n\tif(self.previewActions==undefined) self.previewActions = true;\n\tif(self.previewNumbers==undefined) self.previewNumbers = true;\n\t//if(self.previewVariables==undefined) self.previewVariables = false;\n\tself.activePreview = null;\n\tself.canPreview = function(type){\n\t\ttype = type.charAt(0).toUpperCase() + type.slice(1);\n\t\tvar allowed = self[\"preview\"+type];\n\t\treturn allowed && !self.activePreview;\n\t};\n\n\t// And: automatically create MY widget!\n\tself.createWidget();\n\tif(self.container){ // ...and auto-add my DOM to a container, if provided in options\n\t\tif(typeof self.container===\"string\") self.container=document.body.querySelector(self.container);\n\t\tself.container.appendChild(self.dom);\n\t}\n\n\t// Initialize UI & Modal\n\tJoy.ui.init(self);\n\tJoy.modal.init(self);\n\n\t// Update!\n\tself.onupdate = self.onupdate || function(my){};\n\tself.update = function(){\n\n\t\t// Create a fake \"my\" \n\t\tvar my = {\n\t\t\tactor: self,\n\t\t\tdata: {}\n\t\t};\n\n\t\t// Try to pre-evaluate all data beforehand!\n\t\tself.children.forEach(function(childActor){\n\t\t\tvar dataID = childActor.dataID;\n\t\t\tif(dataID){\n\t\t\t\tvar value = childActor.get();\n\t\t\t\tmy.data[dataID] = value;\n\t\t\t}\n\t\t});\n\n\t\t// Aliases to all children too, though\n\t\tself.children.forEach(function(child){\n\t\t\tif(child.id) my[child.id] = child;\n\t\t});\n\n\t\t// On Update!\n\t\tself.onupdate(my);\n\n\t};\n\tself.update();\n\n\t// Return to sender\n\treturn self;\n\n}\n\n/*****************\n\nACTORS help the Player, Editor & Data talk to each other.\n\nTo create an Actor, you need to pass it a \"options\" object like so:\n(ALL the parameters are optional, btw)\n{\n\tid: \"steps\", // by default, this is actorID AND dataID\n\tdataID: \"steps\", // ONLY if actorID=/=dataID. (e.g. two actors modify same data)\n\ttype: \"number\", // what Actor Template to inherit from, if any\n\tplaceholder: 50 // if no data, what should be the placeholder?\n}\n\n*****************/\n\nJoy.Actor = function(options, parent, data){\n\n\tvar self = this;\n\n\t// Meta\n\tself._class_ = \"Actor\";\n\tself.options = options;\n\tself.parent = parent;\n\tself.top = self.parent ? self.parent.top : self; // if no parent, I'M top dog.\n\n\t// Inherit from Actor Template, if any. THEN inherit from \"options\"\n\tself.type = options.type;\n\tif(self.type){\n\t\tvar actorTemplate = Joy.getTemplateByType(self.type);\n\t\t_configure(self, actorTemplate);\n\t}\n\t_configure(self, self.options);\n\n\t// Adding child actors\n\tself.children = [];\n\tself.addChild = function(child, data){\n\n\t\t// If child's not an Actor, it's options to create a new Actor.\n\t\tif(child._class_!=\"Actor\") child = new Joy.Actor(child, self, data);\n\t\tself.children.push(child);\n\n\t\t// If it has an ID, reference child with ID\n\t\tif(child.id) self[child.id] = child;\n\n\t\t// gimme\n\t\treturn child;\n\n\t};\n\tself.removeChild = function(child){\n\t\t_removeFromArray(self.children, child);\n\t\tchild.kill();\n\t};\n\n\t// Update\n\tself.update = function(){\n\t\tif(self.onupdate) self.onupdate(self); // TODO: make consistent with .act()\n\t\tif(self.parent) self.parent.update();\n\t};\n\n\t// Kill!\n\tself.onkill = self.onkill || function(){};\n\tself.kill = function(){\n\n\t\t// Remove my DOM, if any.\n\t\tif(self.dom && self.dom.parentNode) self.dom.parentNode.removeChild(self.dom);\n\n\t\t// Un-watch my data\n\t\tunwatch(self.data, _onDataChange);\n\n\t\t// Kill all children, too\n\t\twhile(self.children.length>0){\n\t\t\tself.removeChild(self.children[0]);\n\t\t}\n\n\t\t// On Kill?\n\t\tself.onkill(self);\n\n\t};\n\n\t/////////////////////////////////\n\t// ACTOR <-> DATA: //////////////\n\t/////////////////////////////////\n\n\t// Placeholder... convert to {value:w/e} object.\n\tif(self.placeholder===undefined){\n\t\t// If nothing, blank object.\n\t\tself.placeholder = {};\n\t}\n\tif(typeof self.placeholder===\"function\"){\n\t\t// If placeholder's a function, run it!\n\t\tself.placeholder = self.placeholder();\n\t}\n\tif(typeof self.placeholder!==\"object\" || Array.isArray(self.placeholder)){\n\t\t// If placeholder value's not an object (or is array)\n\t\tself.placeholder = {\n\t\t\tvalue: _clone(self.placeholder)\n\t\t};\n\t}\n\t// If data type not already specified, do that!\n\tif(!self.placeholder.type){\n\t\tself.placeholder.type = self.type;\n\t}\n\n\t// If you didn't already pass in a data object, let's figure it out!\n\tself.data = self.data || data;\n\tif(!self.data){\n\t\tvar parent = self.parent;\n\t\tvar dataID = self.dataID;\n\t\tif(parent && dataID){\n\t\t\t// if nothing, put placeholder in parent\n\t\t\tif(!parent.data[dataID]) parent.data[dataID] = _clone(self.placeholder); \n\t\t\tself.data = parent.data[dataID]; // i'm parent's sub-data!\n\t\t}else{\n\t\t\t// ...otherwise, I'm standalone data.\n\t\t\tself.data = _clone(self.placeholder);\n\t\t}\n\t}\n\n\t// Get & Set!\n\tself.getData = function(dataID){\n\t\treturn self.data[dataID];\n\t};\n\tself.setData = function(dataID, newValue, noUpdate){\n\t\t_myEditLock = true; // lock!\n\t\tif(newValue===undefined){\n\t\t\tdelete self.data[dataID]; // DELETE the thing!\n\t\t}else{\n\t\t\tself.data[dataID] = newValue;\n\t\t}\n\t\tsetTimeout(function(){ _myEditLock=false; },1); // some threading issue, i dunno\n\t\tif(!noUpdate) self.update();\n\t};\n\tself.switchData = function(newData){\n\t\tunwatch(self.data, _onDataChange); // unwatch old data\n\t\tself.data = newData;\n\t\twatch(self.data, _onDataChange); // watch new data\n\t\tif(self.onDataChange) self.onDataChange(newData);\n\t};\n\n\t// WATCH DATA\n\tvar _myEditLock = false;\n\tvar _onDataChange = function(attr, op, newValue, oldValue){\t\n\t\tif(_myEditLock) return; // prevent double update\n\t\tif(self.onDataChange) self.onDataChange();\n\t};\n\twatch(self.data, _onDataChange);\n\n\n\t/////////////////////////////////\n\t// ACTOR <-> EDITOR: \"WIDGETS\" //\n\t/////////////////////////////////\n\n\tself.dom = null; // to be created in \"createWidget\"!\n\n\t// Init & Create Widget (if none, just put a \"todo\")\n\tself.initWidget = self.initWidget || function(){\n\t\tself.dom = document.createElement(\"span\");\n\t\tself.dom.innerHTML = \"[todo: '\"+self.type+\"' widget]\";\n\t};\n\tself.createWidget = function(){\n\t\tself.initWidget(self); // bind\n\t\treturn self.dom;\n\t};\n\n\t// \"Preview Data\"\n\tself.previewData = null;\n\t\n\n\t/////////////////////////////////\n\t// ACTOR <-> PLAYER: \"TARGETS\" //\n\t/////////////////////////////////\n\n\t// Actors can ACT ON targets...\n\tself.onact = self.onact || function(){};\n\tself.act = function(target, altData){\n\n\t\t// Real or Preview data?\n\t\tvar data;\n\t\tif(altData){\n\t\t\tdata = _clone(altData);\n\t\t}else if(self.previewData){\n\t\t\tdata = _clone(self.previewData);\n\t\t}else{\n\t\t\tdata = _clone(self.data);\n\t\t}\n\n\t\t// Try to pre-evaluate all data beforehand!\n\t\tself.children.forEach(function(childActor){\n\t\t\tvar dataID = childActor.dataID;\n\t\t\tif(dataID){\n\t\t\t\tvar value = childActor.get(target);\n\t\t\t\tdata[dataID] = value;\n\t\t\t}\n\t\t});\n\n\t\t// On Act!\n\t\treturn self.onact({\n\t\t\tactor: self,\n\t\t\ttarget: target,\n\t\t\tdata: data\n\t\t});\n\n\t};\n\n\t// ...or GET INFO from targets.\n\tself.onget = self.onget || function(){};\n\tself.get = function(target){\n\n\t\t// Real or Preview data?\n\t\tvar data = self.previewData ? self.previewData : self.data;\n\t\tdata = _clone(data);\n\n\t\t// On Get!\n\t\treturn self.onget({\n\t\t\tactor: self,\n\t\t\ttarget: target,\n\t\t\tdata: data\n\t\t});\n\n\t};\n\n\t/////////////////////////////////\n\t// INITIALIZE ///////////////////\n\t/////////////////////////////////\n\n\t// Initialization: string or function?\n\tif(self.init){\n\t\tif(typeof self.init===\"string\") Joy.initializeWithString(self, self.init);\n\t\tif(typeof self.init===\"function\") self.init(self);\n\t}\n\n};\n\n/*****************\n\nACTOR TEMPLATES that future Actors can be made from! Looks like this:\n\nJoy.add({\n\tname: \"Turn turtle\", // what the Actions Widget calls it\n\ttype: \"turtle/turn\", // what it's called in Actor & Data\n\ttags: [\"turtle\", \"action\"], // meta tags\n\tinit: \"Turn {id:'angle', type:'number', placeholder:10} degrees\", // for init'ing actor & widget\n\tonact: function(my){\n\t\tmy.target.turn(my.data.angle);\n\t}\n});\n\n*****************/\n\n// Add Template \nJoy.templates = [];\nJoy.add = function(template){\n\tJoy.templates.push(template);\n};\n\n// Get Template\nJoy.getTemplateByType = function(type){\n\tvar template = Joy.templates.find(function(template){\n\t\treturn template.type==type;\n\t});\n\tif(!template) throw Error(\"No actor template of type '\"+type+\"'!\");\n\treturn template;\n};\nJoy.getTemplatesByTag = function(tag){\n\treturn Joy.templates.filter(function(template){\n\t\treturn template.tags.indexOf(tag)>=0;\n\t});\n};\n\n// Modify Templates\nJoy.modify = function(){\n\n\t// Arguments: (type, callback) or (type, rename, callback)\n\tvar type, rename, callback;\n\tif(arguments.length==2){\n\t\ttype = arguments[0];\n\t\tcallback = arguments[1];\n\t}else{\n\t\ttype = arguments[0];\n\t\trename = arguments[1];\n\t\tcallback = arguments[2];\n\t}\n\n\t// New Template inherits from old...\n\tvar newTemplate = {};\n\tvar _old = Joy.getTemplateByType(type);\n\t_configure(newTemplate, _old);\n\n\t// Then inherits from modifications\n\tvar modifications = callback(_old);\n\t_configure(newTemplate, modifications);\n\n\t// Then, either RENAME or REMOVE old actor template!\n\tif(rename){\n\t\t_old.type = rename;\n\t}else{\n\t\t_removeFromArray(Joy.templates, _old);\n\t}\n\n\t// And add the new one!\n\tJoy.add(newTemplate);\n\n};\n\n// Converts a string into an ENTIRE ACTOR\nJoy.initializeWithString = function(self, markup){\n\tvar actorOptions = [];\n\tvar html = markup;\n\n\t// Split the markup into Actor Options & Widget HTML\n\tvar startIndex = -1;\n\tvar endIndex = -1;\n\tvar stack = 0;\n\t// Go through each character. When you find a top-level \"{...}\" JSON string,\n\t// 1) parse it into an Actor Option\n\t// 2) replace it in the markup with a <span> saying where its widget should go\n\tfor(var i=0; i<html.length; i++){\n\t\tvar character = html[i];\n\n\t\t// ONLY the top-level {...}'s...\n\t\tif(stack==0 && character==\"{\") startIndex=i;\n\t\tif(character==\"{\") stack++;\n\t\tif(character==\"}\") stack--;\n\t\tif(stack==0 && character==\"}\"){\n\t\t\tendIndex = i+1;\n\n\t\t\t// Cut out start to end, save as JSON & replace markup with <span>\n\t\t\tvar json = html.slice(startIndex, endIndex);\n\t\t\tjson = json.replace(/(\\w+)\\:/g,\"'$1':\"); // cleanup: give nameerties quotes\n\t\t\tjson = json.replace(/\\'/g,'\"'); // cleanup: replace ' with \"\n\t\t\tjson = JSON.parse(json);\n\t\t\tjson.dataID = json.dataID || json.id; // cleanup: dataID=id by default\n\t\t\tactorOptions.push(json); // remember option!\n\t\t\thtml = html.substr(0, startIndex)\n\t\t\t\t   + \"<span id='widget_\"+json.id+\"'></span>\"\n\t\t\t\t   + html.substr(endIndex); // replace markup\n\n\t\t\t// GO BACK TO THE BEGINNING & START OVER\n\t\t\t// because i'm too lazy to calculate where the index should go now\n\t\t\ti=0;\n\t\t\tstartIndex = -1;\n\t\t\tendIndex = -1;\n\t\t\tstack = 0;\n\t\t}\n\t}\n\n\t// Create all child Actors\n\tactorOptions.forEach(function(actorOption){\n\t\tself.addChild(actorOption);\n\t});\n\n\t// Create Widget: html, and replace\n\tself.createWidget = function(){\n\n\t\tself.dom = document.createElement(\"span\");\n\t\tself.dom.innerHTML = html;\n\n\t\t// Replace all <spans> with childrens' widgets.\n\t\tself.children.forEach(function(child){\n\n\t\t\t// Make child create a widget!\n\t\t\tchild.createWidget();\n\n\t\t\t// Replace <span> with child's widget\n\t\t\tvar selector = \"#widget_\"+child.id;\n\t\t\tvar span = self.dom.querySelector(selector);\n\t\t\tself.dom.replaceChild(child.dom, span);\n\n\t\t});\n\n\t\t// Return to sender\n\t\treturn self.dom;\n\n\t};\n\n};\n\n/*****************\n\nJOY MODULES\n\nSo that a player can slowly step up the staircase of complexity\n(also maybe import Actors in the future?)\n\n*****************/\n\nJoy.modules = {};\nJoy.module = function(id, callback){\n\tJoy.modules[id] = callback;\n};\nJoy.loadModule = function(id){\n\tvar module = Joy.modules[id];\n\tif(!module) throw Error(\"There's no module called '\"+id+\"'!\");\n\tmodule();\n};\n\n\n/******************************\n\nGETTING & SETTING REFERENCES FROM TOP.DATA\n\nThis is so you can sync variables, functions, strings, object names, etc.\n\nEach reference should have: Unique ID, Tag, Data, Watchers\n// (when Watchers[].length==0, delete that reference. Garbage day)\n\n******************************/\n\nJoy.initReferences = function(actor){\n\t\n\t// Create if not already\n\tvar topdata = actor.top.data;\n\tif(!topdata._references) topdata._references={};\n\n\t// Zero out all connected, it's a brand new world.\n\tfor(var id in topdata._references){\n\t\tvar ref = topdata._references[id];\n\t\tref.connected = 0;\n\t}\n\n};\n\nJoy.createReference = function(actor, tags, data){\n\n\t// The reference\n\tvar topdata = actor.top.data;\n\tvar reference = {\n\t\tid: _generateUID(topdata._references),\n\t\ttags: _forceToArray(tags),\n\t\tdata: data,\n\t\tconnected: 0 // tracks how many actors this thing actually depends on\n\t};\n\ttopdata._references[reference.id] = reference;\n\n\t// Gimme\n\treturn reference;\n\n};\n\nJoy.getReferenceById = function(actor, refID){\n\tvar topdata = actor.top.data;\n\treturn topdata._references[refID];\n};\n\nJoy.getReferencesByTag = function(actor, tag){\n\tvar topdata = actor.top.data;\n\tvar refs = [];\n\tfor(var id in topdata._references){\n\t\tvar ref = topdata._references[id];\n\t\tif(ref.tags.indexOf(tag)>=0) refs.push(ref);\n\t}\n\treturn refs;\n};\n\nJoy.connectReference = function(actor, refID){\n\tvar ref = Joy.getReferenceById(actor, refID);\n\tref.connected++;\n};\n\nJoy.disconnectReference = function(actor, refID){\n\tvar ref = Joy.getReferenceById(actor, refID);\n\tref.connected--;\n\tif(ref.connected==0) Joy.deleteReference(actor, refID);\n};\n\nJoy.deleteReference = function(actor, refID){\n\tvar topdata = actor.top.data;\n\tvar reference = topdata._references[refID];\n\tdelete topdata._references[refID];\n};\n\n/*\nJoy.watchReference = function(topdata, id){\n\tvar reference = topdata._references[id];\n\treference._creators++;\n\treturn reference;\n};\n\nJoy.unwatchReference = function(topdata, id){\n\n\t// The reference?\n\tvar reference = topdata._references[id];\n\treference._creators--;\n\n\t// If no more _creators, DELETE.\n\tif(reference._creators==0) Joy.deleteReference(topdata, id);\n\n\treturn reference;\n\n};\n*/\n\n/******************************\n\nSAVE & LOAD\n\nNo need for a server!\nJust compresses JSON with LZ-String and puts it in the URL\n\n******************************/\n\nJoy.saveToURL = function(data){\n\tvar json = JSON.stringify(data); // Stringify\n\tvar compressed = LZString.compressToEncodedURIComponent(json); // Compress\n\tvar url = window.location.origin+window.location.pathname+\"?data=\"+compressed; // append to current URL\n\t// TODO: keep # and OTHER query stuff the same, just change ?data\n\treturn url;\n};\n\nJoy.loadFromURL = function(){\n\tvar hash = _getParameterByName(\"data\");\n\tvar decompressed = LZString.decompressFromEncodedURIComponent(hash);\n\tif(decompressed){\n\t\tvar data = JSON.parse(decompressed);\n\t\treturn data;\n\t}else{\n\t\treturn null;\n\t}\n};\n/**********************************\n\nRANDOM CRAP TO MAKE MY LIFE EASIER\n\nTODO: namespace these to avoid conflict\n\n**********************************/\n\n// For true believers\nMath.TAU = 2*Math.PI;\n\n// Deep clone\nvar _clone = function(json){\n\treturn JSON.parse(JSON.stringify(json));\n};\n\n// \"Configure\": or just slap all properties of one object onto another\nvar _configure = function(target, config){\n\tfor(var key in config){\n\t\tvar value = config[key];\n\t\ttarget[key] = value;\n\t}\n};\n\n// Array stuff\nvar _removeFromArray = function(array, toDelete){\n\tvar index = array.indexOf(toDelete);\n\tif(index<0) return false;\n\tarray.splice(index,1);\n\treturn true;\n}\n\n// Instant space\nvar _nbsp = function(){\n\tvar span = document.createElement(\"span\");\n\tspan.innerHTML = \"&nbsp;\";\n\treturn span;\n};\n\n// When in Rome, use a completely unuseable numeric system\n// from http://blog.stevenlevithan.com/archives/javascript-roman-numeral-converter\nvar _numberToRoman = function(num){\n    if (!+num)\n        return NaN;\n    var digits = String(+num).split(\"\"),\n        key = [\"\",\"C\",\"CC\",\"CCC\",\"CD\",\"D\",\"DC\",\"DCC\",\"DCCC\",\"CM\",\n               \"\",\"X\",\"XX\",\"XXX\",\"XL\",\"L\",\"LX\",\"LXX\",\"LXXX\",\"XC\",\n               \"\",\"I\",\"II\",\"III\",\"IV\",\"V\",\"VI\",\"VII\",\"VIII\",\"IX\"],\n        roman = \"\",\n        i = 3;\n    while (i--)\n        roman = (key[+digits.pop() + (i * 10)] || \"\") + roman;\n    var result = Array(+digits.join(\"\") + 1).join(\"M\") + roman;\n    return result.toLowerCase();\n}\n\n// Number to Alphabetic Base 26\n// from https://stackoverflow.com/a/8604591\nvar _numberToAlphabet = function(a){\n\n\tvar alpha = \"abcdefghijklmnopqrstuvwxyz\";\n\n\t// First figure out how many digits there are.\n\tvar c = 0;\n\tvar x = 1;      \n\twhile (a >= x) {\n\t\tc++;\n\t\ta -= x;\n\t\tx *= 26;\n\t}\n\n\t// Now you can do normal base conversion.\n\tvar s = \"\";\n\tfor (var i = 0; i < c; i++) {\n\t\ts = alpha.charAt(a % 26) + s;\n\t\ta = Math.floor(a/26);\n\t}\n\treturn s;\n\n};\n\n// Helps prevent copy-pasting weird stuff into contenteditable\n// see: http://jsfiddle.net/marinagon/1v63t05q/\nvar _insertTextAtCursor = function(text){\n\tvar sel, range, html;\n\tif(window.getSelection){\n\t\tsel = window.getSelection();\n\t\tif (sel.getRangeAt && sel.rangeCount) {\n\t\t\trange = sel.getRangeAt(0);\n\t\t\trange.deleteContents();\n\t\t\trange.insertNode(document.createTextNode(text));\n\t\t}\n\t} else if (document.selection && document.selection.createRange) {\n\t\tdocument.selection.createRange().text = text;\n\t}\n};\nvar _preventWeirdCopyPaste = function(element){\n\telement.addEventListener(\"paste\", function(e) {\n\t\te.preventDefault();\n\t\tif (e.clipboardData && e.clipboardData.getData) {\n\t\t\tvar text = e.clipboardData.getData(\"text/plain\");\n\t\t\tdocument.execCommand(\"insertHTML\", false, text);\n\t\t} else if (window.clipboardData && window.clipboardData.getData) {\n\t\t\tvar text = window.clipboardData.getData(\"Text\");\n\t\t\t_insertTextAtCursor(text);\n\t\t}\n\t});\n};\nvar _selectAll = function(input, collapseToEnd){\n\t// select all text in contenteditable\n\t// see http://stackoverflow.com/a/6150060/145346\n\tvar range = document.createRange();\n    range.selectNodeContents(input);\n    if(collapseToEnd) range.collapse(false); // total hack\n    var selection = window.getSelection();\n    selection.removeAllRanges();\n    selection.addRange(range);\n};\nvar _unselectAll = function(){\n\tvar selection = window.getSelection();\n    selection.removeAllRanges();\n};\nvar _fixStringInput = function(input){\n\n\t// Empty? Fix that!\n\tif(input.innerText==\"\"){\n\t\tinput.innerHTML=\"&nbsp;\"; // Is it empty? Let's fix that.\n\t\t_selectAll(input);\n\t}\n\n\t// Line breaks? HECK NO!\n\tif(input.innerHTML.search(\"<br>\")>=0){\n\t\tinput.innerHTML = input.innerHTML.replace(/(\\<br\\>)+/g,\"&nbsp;\");\n\t\t_selectAll(input, true);\n\t}\n\n};\nvar _blurOnEnter = function(input){\n\tinput.addEventListener('keypress', function(event){\n\t    if(event.which===13){\n\t        event.preventDefault();\n\t        input.blur();\n\t    }\n\t});\n};\n\n// Find a unique ID within an object\nvar _generateUID = function(obj){\n\tvar num = 0;\n\tvar id;\n\tdo{\n\t\t//id = Math.floor(Math.random()*1000000)+\"\"; // a MILLION random IDs, hopefully don't go over\n\t\tid = \"id\"+num; // linear time but who cares\n\t\tnum++;\n\t}while(obj[id]);\n\treturn id;\n};\n\n// Make this an array, if not already\nvar _forceToArray = function(thing){\n\tif(Array.isArray(thing)) return thing;\n\telse return [thing];\n};\n\n// Generate a deterministically pseudo-random color from an ID\n// TODO: not looking like crap. same luminance, etc.\n//var _generateColor = function(obj){\t};\n\n// Remove all children from a DOM\nvar _emptyDOM = function(node){\n\twhile(node.hasChildNodes()) node.removeChild(node.lastChild);\n};\n\n// Get Query Param\n// thx to https://stackoverflow.com/a/901144\nvar _getParameterByName = function(name, url) {\n    if (!url) url = window.location.href;\n    name = name.replace(/[\\[\\]]/g, \"\\\\$&\");\n    var regex = new RegExp(\"[?&]\" + name + \"(=([^&#]*)|&|#|$)\"),\n        results = regex.exec(url);\n    if (!results) return null;\n    if (!results[2]) return '';\n    return decodeURIComponent(results[2].replace(/\\+/g, \" \"));\n}\n\n////////////////////////////\n// Good Color Shtuff ///////\n// thx to: https://stackoverflow.com/questions/17242144/javascript-convert-hsb-hsv-color-to-rgb-accurately/17243070#17243070\n////////////////////////////\n\n/* accepts parameters\n * h  Object = {h:x, s:y, v:z}\n * OR \n * h, s, v\n*/\nfunction _HSVtoRGB(h, s, v) {\n    var r, g, b, i, f, p, q, t;\n    if (arguments.length === 1) {\n        s = h.s, v = h.v, h = h.h;\n    }\n    h /= 360; // convert, yo.\n    i = Math.floor(h * 6);\n    f = h * 6 - i;\n    p = v * (1 - s);\n    q = v * (1 - f * s);\n    t = v * (1 - (1 - f) * s);\n    switch (i % 6) {\n        case 0: r = v, g = t, b = p; break;\n        case 1: r = q, g = v, b = p; break;\n        case 2: r = p, g = v, b = t; break;\n        case 3: r = p, g = q, b = v; break;\n        case 4: r = t, g = p, b = v; break;\n        case 5: r = v, g = p, b = q; break;\n    }\n    return [Math.round(r*255), Math.round(g*255), Math.round(b*255)];\n}\nfunction _HSVToRGBString(h,s,v){\n\tif(arguments.length===1) {\n        s=h[1], v=h[2], h=h[0]; // cast to different vars\n    }\n\tvar rgb = _HSVtoRGB(h,s,v);\n\treturn \"rgb(\"+rgb[0]+\",\"+rgb[1]+\",\"+rgb[2]+\")\";\n}\n// well, \"random\"\nvar _randomHSVIndex = 0;\nvar _randomHSVArray = [\n      [0, 0.6, 1.0],\n\t [30, 0.8, 1.0],\n\t//[120, 0.9, 0.9],\n\t[210, 0.8, 1.0],\n\t[260, 0.7, 1.0],\n\t[310, 0.6, 1.0]\n];\nfunction _randomHSV(){\n\tvar hsv = _randomHSVArray[_randomHSVIndex];\n\t_randomHSVIndex = (_randomHSVIndex+1)%_randomHSVArray.length;\n\t//return _HSVToRGBString(hsv[0], hsv[1], hsv[2]);\n\treturn hsv;\n}\nfunction _forceToRGB(color){\n\tif(Array.isArray(color)){\n\t\tcolor = _HSVToRGBString(color[0], color[1], color[2]); // HSV\n\t}\n\treturn color;\n}\n\n/**\n * DEVELOPED BY\n * GIL LOPES BUENO\n * gilbueno.mail@gmail.com\n *\n * WORKS WITH:\n * IE8*, IE 9+, FF 4+, SF 5+, WebKit, CH 7+, OP 12+, BESEN, Rhino 1.7+\n * For IE8 (and other legacy browsers) WatchJS will use dirty checking  \n *\n * FORK:\n * https://github.com/melanke/Watch.JS\n *\n * LICENSE: MIT\n */\n\"use strict\";!function(a){\"object\"==typeof exports?module.exports=a():\"function\"==typeof define&&define.amd?define(a):(window.WatchJS=a(),window.watch=window.WatchJS.watch,window.unwatch=window.WatchJS.unwatch,window.callWatchers=window.WatchJS.callWatchers)}(function(){function x(){w=null;for(var a=0;a<v.length;a++)v[a]();v.length=0}var a={noMore:!1,useDirtyCheck:!1},b=[],c=[],d=[],e=!1;try{e=Object.defineProperty&&Object.defineProperty({},\"x\",{})}catch(a){}var f=function(a){var b={};return a&&\"[object Function]\"==b.toString.call(a)},h=function(a){return\"[object Array]\"===Object.prototype.toString.call(a)},i=function(a){return\"[object Object]\"==={}.toString.apply(a)},j=function(a,b){var c=[],d=[];if(\"string\"!=typeof a&&\"string\"!=typeof b){if(h(a)&&b)for(var e=0;e<a.length;e++)void 0===b[e]&&c.push(e);else for(var e in a)a.hasOwnProperty(e)&&b&&void 0===b[e]&&c.push(e);if(h(b)&&a)for(var f=0;f<b.length;f++)void 0===a[f]&&d.push(f);else for(var f in b)b.hasOwnProperty(f)&&a&&void 0===a[f]&&d.push(f)}return{added:c,removed:d}},k=function(a){if(null==a||\"object\"!=typeof a)return a;var b=a.constructor();for(var c in a)b[c]=a[c];return b},l=function(a,b,c,d){try{Object.observe(a,function(a){a.forEach(function(a){a.name===b&&d(a.object[a.name])})})}catch(e){try{Object.defineProperty(a,b,{get:c,set:function(a){d.call(this,a,!0)},enumerable:!0,configurable:!0})}catch(e){try{Object.prototype.__defineGetter__.call(a,b,c),Object.prototype.__defineSetter__.call(a,b,function(a){d.call(this,a,!0)})}catch(c){n(a,b,d)}}}},m=function(a,b,c){try{Object.defineProperty(a,b,{enumerable:!1,configurable:!0,writable:!1,value:c})}catch(d){a[b]=c}},n=function(a,b,d){c[c.length]={prop:b,object:a,orig:k(a[b]),callback:d}},o=function(){f(arguments[1])?p.apply(this,arguments):h(arguments[1])?q.apply(this,arguments):r.apply(this,arguments)},p=function(a,b,c,d){if(\"string\"!=typeof a&&(a instanceof Object||h(a))){if(h(a)){if(D(a,\"__watchall__\",b,c),void 0===c||c>0)for(var f=0;f<a.length;f++)p(a[f],b,c,d)}else{var f,g=[];for(f in a)\"$val\"==f||!e&&\"watchers\"===f||Object.prototype.hasOwnProperty.call(a,f)&&g.push(f);q(a,g,b,c,d)}d&&R(a,\"$$watchlengthsubjectroot\",b,c)}},q=function(a,b,c,d,e){if(\"string\"!=typeof a&&(a instanceof Object||h(a)))for(var f=0;f<b.length;f++){var g=b[f];r(a,g,c,d,e)}},r=function(a,b,c,d,e){\"string\"!=typeof a&&(a instanceof Object||h(a))&&(f(a[b])||(null!=a[b]&&(void 0===d||d>0)&&p(a[b],c,void 0!==d?d-1:d),D(a,b,c,d),e&&(void 0===d||d>0)&&R(a,b,c,d)))},s=function(){f(arguments[1])?t.apply(this,arguments):h(arguments[1])?u.apply(this,arguments):I.apply(this,arguments)},t=function(a,b){if(!(a instanceof String)&&(a instanceof Object||h(a)))if(h(a)){for(var c=[\"__watchall__\"],d=0;d<a.length;d++)c.push(d);u(a,c,b)}else{var e=function(a){var c=[];for(var d in a)a.hasOwnProperty(d)&&(a[d]instanceof Object?e(a[d]):c.push(d));u(a,c,b)};e(a)}},u=function(a,b,c){for(var d in b)b.hasOwnProperty(d)&&I(a,b[d],c)},v=[],w=null,y=function(){return w||(w=setTimeout(x)),w},z=function(a){null==w&&y(),v[v.length]=a},A=function(){var a=f(arguments[2])?C:B;a.apply(this,arguments)},B=function(a,b,c,d){var i,e=null,f=-1,g=h(a),j=function(c,d,h,i){var j=y();if(f!==j&&(f=j,e={type:\"update\"},e.value=a,e.splices=null,z(function(){b.call(this,e),e=null})),g&&a===this&&null!==e){if(\"pop\"===d||\"shift\"===d)h=[],i=[i];else if(\"push\"===d||\"unshift\"===d)h=[h],i=[];else if(\"splice\"!==d)return;e.splices||(e.splices=[]),e.splices[e.splices.length]={index:c,deleteCount:i?i.length:0,addedCount:h?h.length:0,added:h,deleted:i}}};i=1==c?void 0:0,p(a,j,i,d)},C=function(a,b,c,d,e){a&&b&&(r(a,b,function(a,b,f,g){var j={type:\"update\"};j.value=f,j.oldvalue=g,(d&&i(f)||h(f))&&B(f,c,d,e),c.call(this,j)},0),(d&&i(a[b])||h(a[b]))&&B(a[b],c,d,e))},D=function(b,c,d,e){var f=!1,g=h(b);b.watchers||(m(b,\"watchers\",{}),g&&H(b,function(a,d,f,g){if(N(b,a,d,f,g),0!==e&&f&&(i(f)||h(f))){var j,k,l,m,n=b.watchers[c];for((m=b.watchers.__watchall__)&&(n=n?n.concat(m):m),l=n?n.length:0,j=0;j<l;j++)if(\"splice\"!==d)p(f,n[j],void 0===e?e:e-1);else for(k=0;k<f.length;k++)p(f[k],n[j],void 0===e?e:e-1)}})),b.watchers[c]||(b.watchers[c]=[],g||(f=!0));for(var j=0;j<b.watchers[c].length;j++)if(b.watchers[c][j]===d)return;if(b.watchers[c].push(d),f){var k=b[c],o=function(){return k},q=function(d,f){var g=k;if(k=d,0!==e&&b[c]&&(i(b[c])||h(b[c]))&&!b[c].watchers){var j,l=b.watchers[c].length;for(j=0;j<l;j++)p(b[c],b.watchers[c][j],void 0===e?e:e-1)}return K(b,c)?void L(b,c):void(a.noMore||g!==d&&(f?N(b,c,\"set\",d,g):E(b,c,\"set\",d,g),a.noMore=!1))};a.useDirtyCheck?n(b,c,q):l(b,c,o,q)}},E=function(a,b,c,d,e){if(void 0!==b){var f,g,h=a.watchers[b];(g=a.watchers.__watchall__)&&(h=h?h.concat(g):g),f=h?h.length:0;for(var i=0;i<f;i++)h[i].call(a,b,c,d,e)}else for(var b in a)a.hasOwnProperty(b)&&E(a,b,c,d,e)},F=[\"pop\",\"push\",\"reverse\",\"shift\",\"sort\",\"slice\",\"unshift\",\"splice\"],G=function(a,b,c,d){m(a,c,function(){var f,g,h,i,e=0;if(\"splice\"===c){var j=arguments[0],k=j+arguments[1];for(h=a.slice(j,k),g=[],f=2;f<arguments.length;f++)g[f-2]=arguments[f];e=j}else g=arguments.length>0?arguments[0]:void 0;return i=b.apply(a,arguments),\"slice\"!==c&&(\"pop\"===c?(h=i,e=a.length):\"push\"===c?e=a.length-1:\"shift\"===c?h=i:\"unshift\"!==c&&void 0===g&&(g=i),d.call(a,e,c,g,h)),i})},H=function(a,b){if(f(b)&&a&&!(a instanceof String)&&h(a))for(var d,c=F.length;c--;)d=F[c],G(a,a[d],d,b)},I=function(a,b,c){if(b){if(a.watchers[b])if(void 0===c)delete a.watchers[b];else for(var d=0;d<a.watchers[b].length;d++){var e=a.watchers[b][d];e==c&&a.watchers[b].splice(d,1)}}else delete a.watchers;S(a,b,c),T(a,b)},J=function(a,b){if(a.watchers){var c=\"__wjs_suspend__\"+(void 0!==b?b:\"\");a.watchers[c]=!0}},K=function(a,b){return a.watchers&&(a.watchers.__wjs_suspend__||a.watchers[\"__wjs_suspend__\"+b])},L=function(a,b){z(function(){delete a.watchers.__wjs_suspend__,delete a.watchers[\"__wjs_suspend__\"+b]})},M=null,N=function(a,b,c,e,f){d[d.length]={obj:a,prop:b,mode:c,newval:e,oldval:f},null===M&&(M=setTimeout(O))},O=function(){var a=null;M=null;for(var b=0;b<d.length;b++)a=d[b],E(a.obj,a.prop,a.mode,a.newval,a.oldval);a&&(d=[],a=null)},P=function(){for(var a=0;a<b.length;a++){var d=b[a];if(\"$$watchlengthsubjectroot\"===d.prop){var e=j(d.obj,d.actual);(e.added.length||e.removed.length)&&(e.added.length&&q(d.obj,e.added,d.watcher,d.level-1,!0),d.watcher.call(d.obj,\"root\",\"differentattr\",e,d.actual)),d.actual=k(d.obj)}else{var e=j(d.obj[d.prop],d.actual);if(e.added.length||e.removed.length){if(e.added.length)for(var f=0;f<d.obj.watchers[d.prop].length;f++)q(d.obj[d.prop],e.added,d.obj.watchers[d.prop][f],d.level-1,!0);E(d.obj,d.prop,\"differentattr\",e,d.actual)}d.actual=k(d.obj[d.prop])}}var g,h;if(c.length>0)for(var a=0;a<c.length;a++)g=c[a],h=g.object[g.prop],Q(g.orig,h)||(g.orig=k(h),g.callback(h))},Q=function(a,b){var c,d=!0;if(a!==b)if(i(a)){for(c in a)if((e||\"watchers\"!==c)&&a[c]!==b[c]){d=!1;break}}else d=!1;return d},R=function(a,c,d,e){var f;f=k(\"$$watchlengthsubjectroot\"===c?a:a[c]),b.push({obj:a,prop:c,actual:f,watcher:d,level:e})},S=function(a,c,d){for(var e=0;e<b.length;e++){var f=b[e];f.obj==a&&(c&&f.prop!=c||d&&f.watcher!=d||b.splice(e--,1))}},T=function(a,b){for(var d,e=0;e<c.length;e++){var f=c[e],g=f.object.watchers;d=f.object==a&&(!b||f.prop==b)&&g&&(!b||!g[b]||0==g[b].length),d&&c.splice(e--,1)}};return setInterval(P,50),a.watch=o,a.unwatch=s,a.callWatchers=E,a.suspend=J,a.onChange=A,a});var LZString=function(){function o(o,r){if(!t[o]){t[o]={};for(var n=0;n<o.length;n++)t[o][o.charAt(n)]=n}return t[o][r]}var r=String.fromCharCode,n=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",e=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\",t={},i={compressToBase64:function(o){if(null==o)return\"\";var r=i._compress(o,6,function(o){return n.charAt(o)});switch(r.length%4){default:case 0:return r;case 1:return r+\"===\";case 2:return r+\"==\";case 3:return r+\"=\"}},decompressFromBase64:function(r){return null==r?\"\":\"\"==r?null:i._decompress(r.length,32,function(e){return o(n,r.charAt(e))})},compressToUTF16:function(o){return null==o?\"\":i._compress(o,15,function(o){return r(o+32)})+\" \"},decompressFromUTF16:function(o){return null==o?\"\":\"\"==o?null:i._decompress(o.length,16384,function(r){return o.charCodeAt(r)-32})},compressToUint8Array:function(o){for(var r=i.compress(o),n=new Uint8Array(2*r.length),e=0,t=r.length;t>e;e++){var s=r.charCodeAt(e);n[2*e]=s>>>8,n[2*e+1]=s%256}return n},decompressFromUint8Array:function(o){if(null===o||void 0===o)return i.decompress(o);for(var n=new Array(o.length/2),e=0,t=n.length;t>e;e++)n[e]=256*o[2*e]+o[2*e+1];var s=[];return n.forEach(function(o){s.push(r(o))}),i.decompress(s.join(\"\"))},compressToEncodedURIComponent:function(o){return null==o?\"\":i._compress(o,6,function(o){return e.charAt(o)})},decompressFromEncodedURIComponent:function(r){return null==r?\"\":\"\"==r?null:(r=r.replace(/ /g,\"+\"),i._decompress(r.length,32,function(n){return o(e,r.charAt(n))}))},compress:function(o){return i._compress(o,16,function(o){return r(o)})},_compress:function(o,r,n){if(null==o)return\"\";var e,t,i,s={},p={},u=\"\",c=\"\",a=\"\",l=2,f=3,h=2,d=[],m=0,v=0;for(i=0;i<o.length;i+=1)if(u=o.charAt(i),Object.prototype.hasOwnProperty.call(s,u)||(s[u]=f++,p[u]=!0),c=a+u,Object.prototype.hasOwnProperty.call(s,c))a=c;else{if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;h>e;e++)m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;for(t=a.charCodeAt(0),e=0;8>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;h>e;e++)m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=a.charCodeAt(0),e=0;16>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a]}else for(t=s[a],e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;l--,0==l&&(l=Math.pow(2,h),h++),s[c]=f++,a=String(u)}if(\"\"!==a){if(Object.prototype.hasOwnProperty.call(p,a)){if(a.charCodeAt(0)<256){for(e=0;h>e;e++)m<<=1,v==r-1?(v=0,d.push(n(m)),m=0):v++;for(t=a.charCodeAt(0),e=0;8>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;h>e;e++)m=m<<1|t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=a.charCodeAt(0),e=0;16>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}l--,0==l&&(l=Math.pow(2,h),h++),delete p[a]}else for(t=s[a],e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;l--,0==l&&(l=Math.pow(2,h),h++)}for(t=2,e=0;h>e;e++)m=m<<1|1&t,v==r-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;for(;;){if(m<<=1,v==r-1){d.push(n(m));break}v++}return d.join(\"\")},decompress:function(o){return null==o?\"\":\"\"==o?null:i._decompress(o.length,32768,function(r){return o.charCodeAt(r)})},_decompress:function(o,n,e){var t,i,s,p,u,c,a,l,f=[],h=4,d=4,m=3,v=\"\",w=[],A={val:e(0),position:n,index:1};for(i=0;3>i;i+=1)f[i]=i;for(p=0,c=Math.pow(2,2),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(t=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;l=r(p);break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;l=r(p);break;case 2:return\"\"}for(f[3]=l,s=l,w.push(l);;){if(A.index>o)return\"\";for(p=0,c=Math.pow(2,m),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;switch(l=p){case 0:for(p=0,c=Math.pow(2,8),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 1:for(p=0,c=Math.pow(2,16),a=1;a!=c;)u=A.val&A.position,A.position>>=1,0==A.position&&(A.position=n,A.val=e(A.index++)),p|=(u>0?1:0)*a,a<<=1;f[d++]=r(p),l=d-1,h--;break;case 2:return w.join(\"\")}if(0==h&&(h=Math.pow(2,m),m++),f[l])v=f[l];else{if(l!==d)return null;v=s+s.charAt(0)}w.push(v),f[d++]=s+v.charAt(0),h--,s=v,0==h&&(h=Math.pow(2,m),m++)}}};return i}();\"function\"==typeof define&&define.amd?define(function(){return LZString}):\"undefined\"!=typeof module&&null!=module&&(module.exports=LZString);\n(function(){\n\n// SINGLETON\nvar ui = {};\nJoy.ui = ui;\n\nui.init = function(master){\n\n\t// CSS\n\tmaster.dom.classList.add(\"joy-master\");\n\n\t// Manual Scroll (to prevent it propagating up...)\n\tmaster.container.addEventListener('wheel', function(event){\n\t\tvar delta = event.deltaY;\n\t\tmaster.container.scrollTop += delta;\n\t\tevent.preventDefault();\n\t\treturn false;\n\t});\n\n\t// Prevent accidental backspace-history\n\t// because why the heck is this even a thing, jeez.\n\t// thx: https://stackoverflow.com/a/2768256\n\tdocument.body.addEventListener('keydown', function(event){\n\t    if(event.keyCode === 8) {\n\t        var doPrevent = true;\n\t        var types = [\"text\", \"password\", \"file\", \"search\", \"email\", \"number\", \"date\", \"color\", \"datetime\", \"datetime-local\", \"month\", \"range\", \"search\", \"tel\", \"time\", \"url\", \"week\"];\n\t        var d = event.srcElement || event.target;\n\t        var disabled = d.getAttribute(\"readonly\") || d.getAttribute(\"disabled\");\n\t        if (!disabled) {\n\t            if (d.isContentEditable) {\n\t                doPrevent = false;\n\t            } else if (d.tagName.toUpperCase() == \"INPUT\") {\n\t                var type = d.getAttribute(\"type\");\n\t                if (type) {\n\t                    type = type.toLowerCase();\n\t                }\n\t                if (types.indexOf(type) > -1) {\n\t                    doPrevent = false;\n\t                }\n\t            } else if (d.tagName.toUpperCase() == \"TEXTAREA\") {\n\t                doPrevent = false;\n\t            }\n\t        }\n\t        if (doPrevent) {\n\t            event.preventDefault();\n\t            return false;\n\t        }\n\t    }\n\t});\n\n};\n\n/********************\nButton's config:\n{\n\tlabel: \"derp\",\n\tonclick: function(){},\n\tstyles: [\"round\", \"hollow\"] // optional\n}\n********************/\nui.Button = function(config){\n\t\n\tvar self = this;\n\n\t// DOM. Pretty simple.\n\tvar dom = document.createElement(\"div\");\n\tdom.className = \"joy-button\";\n\tself.dom = dom;\n\n\t// Setting Label\n\tconfig.label = config.label || \"\";\n\tself.label = document.createElement(\"span\");\n\tdom.appendChild(self.label);\n\tself.setLabel = function(newLabel){\n\t\tself.label.innerHTML = newLabel;\n\t};\n\tself.setLabel(config.label);\n\n\t// On Click\n\tdom.onclick = function(){\n\t\tconfig.onclick();\n\t};\n\n\t// Styles\n\tself.styles = config.styles || [];\n\tfor(var i=0; i<self.styles.length; i++) dom.classList.add(self.styles[i]);\n\n};\n\n/********************\nChooserButton's config:\n{\n\tvalue: [current value], (optional)\n\tstaticLabel: \"+\", (optional)\n\toptions: options,\n\tonchange: function(value){},\n\tposition: \"left\" // optional: for the Joy.modal\n\tstyles: [\"round\", \"hollow\"] // optional: for the button\n}\n********************/\nui.ChooserButton = function(config){\n\t\n\tvar self = this;\n\n\t// Properties\n\tself.value = config.value;\n\tself.options = config.options; // expose, coz may change later\n\tself.onchange = config.onchange;\n\n\t// IF NO VALUE, PICK FIRST ONE, WHATEVER\n\tif(!self.value){\n\t\tself.value = self.options[0].value;\n\t}\n\n\t// This is just a Button that calls Chooser Popup when clicked\n\tui.Button.call(self, {\n\t\tlabel: (config.staticLabel===undefined) ? \"\" : config.staticLabel,\n\t\tonclick: function(){\n\n\t\t\t// Chooser Modal!\n\t\t\tJoy.modal.Chooser({\n\t\t\t\tsource: self.dom,\n\t\t\t\toptions: self.options,\n\t\t\t\tonchange: function(value){\n\n\t\t\t\t\t// Update value & label\n\t\t\t\t\tself.value = value;\n\t\t\t\t\t_updateLabel();\n\n\t\t\t\t\t// On Select callback\n\t\t\t\t\tself.onchange(value);\n\n\t\t\t\t},\n\t\t\t\tposition: config.position\n\t\t\t});\n\t\t\t\n\t\t},\n\t\tstyles: config.styles\n\t});\n\n\t// Helper method\n\tvar _updateLabel = function(){\n\t\t\n\t\tif(config.staticLabel!==undefined) return; // if static, no.\n\n\t\t// Otherwise, find the corresponding label to my current value & set to that.\n\t\tvar label = self.options.find(function(pair){\n\t\t\treturn pair.value==self.value;\n\t\t}).label;\n\t\tself.setLabel(label);\n\n\t};\n\t_updateLabel();\n\n};\n\n/********************\nScrubber's config:\n{\n\tmin: 0,\n\tmax: 180,\n\tvalue: [current value],\n\tonchange: function(value){}\n}\n********************/\nui.Scrubber = function(config){\n\n\tvar self = this;\n\n\t// Config...\n\tvar min = config.min;\n\tvar max = config.max;\n\n\t// console.log(config);\n\n\tself.value = config.value;\n\n\t// DOM\n\tvar dom = document.createElement(\"div\");\n\tdom.className = \"joy-scrubber\";\n\tself.dom = dom;\n\n\t// DOM *is* Label\n\tself.setLabel = function(newValue){\n\t\tdom.innerHTML = newValue.toFixed(self.sigfigs);\n\t};\n\n\t// On Value Change: make sure it's the right num of sigfigs\n\tvar _onValueChange = function(newValue){\n\t\tnewValue = parseFloat(newValue.toFixed(self.sigfigs));\n\t\tconfig.onchange(newValue);\n\t};\n\n\t// DRAG IT, BABY\n\tvar isDragging = false;\n\tvar wasDragging = false;\n\tvar lastDragX, startDragValue;\n\tvar delta = 0;\n\tvar _onmousedown = function(event){\n\t\tisDragging = true;\n\t\tlastDragX = event.clientX;\n\t\tstartDragValue = self.value;\n\t\tdelta = 0;\n\t\tif(config.onstart) config.onstart();\n\t};\n\tvar _onmousemove = function(event){\n\t\tif(isDragging){\n\n\t\t\twasDragging = true;\n\n\t\t\t// What's the step?\n\t\t\tvar step = Math.pow(0.1,self.sigfigs);\n\t\t\tstep = parseFloat(step.toPrecision(1)); // floating point crap\n\t\t\t\n\t\t\t// Change number\n\t\t\tvar velocity = event.clientX - lastDragX;\n\t\t\tlastDragX = event.clientX;\n\t\t\tvar multiplier = Math.abs(velocity/10);\n\t\t\tif(multiplier<1) multiplier=1;\n\t\t\tif(multiplier>3) multiplier=3;\n\t\t\tdelta += velocity*multiplier;\n\t\t\tvar dx = Math.floor(delta/2);\n\t\t\tvar newValue = startDragValue + dx*step;\n\t\t\tnewValue = _boundNumber(newValue);\n\t\t\t\n\t\t\t// Only update if ACTUALLY new.\n\t\t\tif(self.value != newValue){\n\t\t\t\tself.value = newValue;\n\t\t\t\tself.setLabel(newValue);\n\t\t\t\t_onValueChange(newValue);\n\t\t\t}\n\n\t\t}\n\t};\n\tvar _boundNumber = function(newValue){\n\t\tif(min!==undefined && newValue<min) newValue=min;\n\t\tif(max!==undefined && newValue>max) newValue=max;\n\t\t// console.log(\"min \", min, \" max \", max);\n\t\treturn newValue;\n\t};\n\tvar _onmouseup = function(){\n\t\tisDragging = false;\n\t\tif(config.onstop) config.onstop();\n\t\tsetTimeout(function(){\n\t\t\twasDragging = false; // so can't \"click\" if let go on scrubber\n\t\t},1);\n\t};\n\n\t// MOUSE EVENTS\n\tdom.addEventListener(\"mousedown\", _onmousedown);\n\twindow.addEventListener(\"mousemove\", _onmousemove);\n\twindow.addEventListener(\"mouseup\", _onmouseup);\n\n\t// KILL ALL LISTENERS\n\tself.kill = function(){\n\t\tdom.removeEventListener(\"mousedown\", _onmousedown);\n\t\twindow.removeEventListener(\"mousemove\", _onmousemove);\n\t\twindow.removeEventListener(\"mouseup\", _onmouseup);\n\t};\n\n\t// On click: edit manually!\n\tvar _manuallyEditing = false;\n\tdom.onblur = function(){\n\t\tif(_manuallyEditing){\n\n\t\t\t_manuallyEditing = false;\n\t\t\tdom.contentEditable = false;\n\t\t\t_unselectAll();\n\n\t\t\t// Done manually updating! The new number!\n\t\t\t_countSigFigs(dom.innerText); // re-calc sigfigs\n\t\t\tself.value = _parseNumber();\n\t\t\tself.setLabel(self.value);\n\t\t\t_onValueChange(self.value);\n\n\t\t\t// On Stop editing\n\t\t\tif(config.onstop) config.onstop();\n\n\t\t}\n\t};\n\t_preventWeirdCopyPaste(dom);\n\t_blurOnEnter(dom);\n\tdom.onclick = function(){\n\n\t\tif(wasDragging) return; // can't click if I was just dragging!\n\n\t\t_manuallyEditing = true;\n\t\t\n\t\t// Make it editable, and select it!\n\t\tdom.contentEditable = true;\n\t\tdom.spellcheck = false;\n\t\t_selectAll(dom);\n\n\t\t// On Start editing\n\t\tif(config.onstart) config.onstart();\n\n\t};\n\tdom.oninput = function(event){\n\n\t\tif(!_manuallyEditing) return;\n\n\t\t// Also, no non-decimal or numbers\n\t\tvar regex = /[^0-9.\\-]/g;\n\t\tif(dom.innerText.match(regex)){\n\t\t\tdom.innerText = dom.innerText.replace(regex,\"\");\n\t\t}\n\t\t_fixStringInput(dom);\n\n\t\t// Show that change!\n\t\t_onValueChange(_parseNumber());\n\n\t};\n\tvar _parseNumber = function(){\n\t\tvar num = parseFloat(dom.innerText);\n\t\tif(isNaN(num)) num=0;\n\t\tnum = _boundNumber(num);\n\t\treturn num;\n\t};\n\n\t// How many significant digits?\n\tself.sigfigs = 0;\n\tvar _countSigFigs = function(string){\n\t\tstring = string.toString();\n\t\tvar sigfigs;\n\t\tvar positionOfPeriod = string.search(/\\./);\n\t\tif(positionOfPeriod>=0){ // has a period\n\t\t\tsigfigs = (string.length-1)-positionOfPeriod;\n\t\t}else{\n\t\t\tsigfigs = 0;\n\t\t}\n\t\tself.sigfigs = sigfigs;\n\t};\n\t_countSigFigs(self.value);\n\n\t// Current value...\n\tself.setLabel(self.value);\n\n};\n\n/********************\nString's config:\n{\n\tprefix: \"[\",\n\tsuffix: \"]\",\n\tcolor:\"whatever\",\n\tvalue: data.value,\n\tonchange: function(value){\n\t\tdata.value = value;\n\t\tself.update();\n\t},\n\tstyles: [\"comment\"]\n}\n********************/\nui.String = function(config){\n\t\n\tvar self = this;\n\n\t// DOM\n\tvar dom = document.createElement(\"div\");\n\tdom.className = \"joy-string\";\n\tself.dom = dom;\n\t\n\t// The Actual Part that's Content Editable\n\tvar input = document.createElement(\"span\");\n\tinput.contentEditable = true;\n\tinput.spellcheck = false;\n\n\t// Prefix & Suffix & Color: entirely cosmetic\n\tvar prefixDOM = document.createElement(\"span\");\n\tvar suffixDOM = document.createElement(\"span\");\n\tprefixDOM.innerHTML = config.prefix || \"\";\n\tsuffixDOM.innerHTML = config.suffix || \"\";\n\tdom.appendChild(prefixDOM);\n\tdom.appendChild(input);\n\tdom.appendChild(suffixDOM);\n\n\t// On input!\n\tinput.oninput = function(event){\n\t\t_fixStringInput(input);\n\t\tvar value = input.innerText; // NOT innerHTML\n\t\tconfig.onchange(value); // callback!\n\t};\n\n\t// On focus, select all\n\tinput.onfocus = function(){\n\t\t_selectAll(input);\n\t};\n\tinput.onblur = function(){\n\t\t_unselectAll();\n\t};\n\t_preventWeirdCopyPaste(input);\n\n\t// On pressing <enter>, DON'T line break, just blur\n\tinput.onkeypress = function(e){\n\t\tif(e.which == 13){\n\t\t\tinput.blur();\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t};\n\n\t// Set String\n\tself.setString = function(value){\n\t\tinput.innerText = value;\n\t\t_fixStringInput(input);\n\t};\n\n\t// Set Color, why not\n\tself.setColor = function(color){\n\t\tcolor = _forceToRGB(color);\n\t\tdom.style.color = color;\n\t\tdom.style.borderColor = color;\n\t}\n\tif(config.color) self.setColor(config.color);\n\n\t// Styles\n\tself.styles = config.styles || [];\n\tfor(var i=0; i<self.styles.length; i++) dom.classList.add(self.styles[i]);\n\n\t// Start with the current value\n\tself.setString(config.value);\n\n};\n\n/********************\nTextLine's config:\n{\n\tmultiline: true,\n\treadonly: true,\n\twidth: number or \"[style]\",\n\tonchange: function(newValue){},\n\tplaceholder: \"//derp\"\n\tstyles: [\"box\"]\n}\n********************/\n// TODO: a full WSIYWIG editor?\n// https://hackernoon.com/easily-create-an-html-editor-with-designmode-and-contenteditable-7ed1c465d39b\nui.TextBox = function(config){\n\t\n\tvar self = this;\n\n\t// DOM\n\tvar input;\n\tif(config.multiline){\n\t\tinput = document.createElement(\"textarea\");\n\t}else{\n\t\tinput = document.createElement(\"input\");\n\t\tinput.type = \"text\";\n\t}\n\tif(config.placeholder){\n\t\tinput.placeholder = config.placeholder;\n\t}\n\tinput.spellcheck = false;\n\tinput.className = \"joy-textbox\";\n\tself.dom = input;\n\tvar dom = self.dom;\n\n\t// Config options\n\tif(config.readonly){\n\t\tinput.setAttribute(\"readonly\", 1);\n\t\tinput.addEventListener(\"click\",function(){\n\t\t\tself.select();\n\t\t});\n\t}else{\n\t\tinput.oninput = function(event){\n\t\t\tconfig.onchange(input.value);\n\t\t};\n\t}\n\tif(config.width){\n\t\tinput.style.width = (typeof config.width===\"number\") ? config.width+\"px\" : config.width;\n\t}\n\t\n\t// Get & Set Value\n\tself.getValue = function(){ return input.value; };\n\tself.setValue = function(value){ input.value = value; };\n\n\t// Select\n\tself.select = function(){\n\t\tinput.select();\n\t};\n\n\t// Styles\n\tself.styles = config.styles || [];\n\tfor(var i=0; i<self.styles.length; i++) dom.classList.add(self.styles[i]);\n\n\t// Start\n\tif(config.value) self.setValue(config.value);\n\n\t// If it's multiline, auto-resize!\n\t// Thanks to this: https://stackoverflow.com/a/25621277\n\tif(config.multiline){\n\t\tvar _onInput = function(){\n\t\t\tthis.style.height = 'auto';\n\t\t\tthis.style.height = (this.scrollHeight) + 'px';\n\t\t};\n\t\tdom.addEventListener(\"input\", _onInput, false);\n\t\tsetTimeout(function(){\n\t\t\tdom.setAttribute('style', 'height:' + (dom.scrollHeight) + 'px; overflow-y:hidden;');\n\t\t},1); // some threading thing?\n\t}\n\n};\n\n})();/********************\n\nMODAL:\nPlaces a big ol' modal dialogue bubble over the editor!\n\n********************/\n(function(){\n\n// SINGLETON\nvar modal = {};\nJoy.modal = modal;\n\nmodal.init = function(master){\n\n\t// The main modal container\n\tmodal.dom = document.createElement(\"div\");\n\tmodal.dom.id = \"joy-modal\";\n\tdocument.body.appendChild(modal.dom);\n\n\t// Transparent background you click to kill!\n\tmodal.bg = document.createElement(\"div\");\n\tmodal.bg.id = \"joy-bg\";\n\tmodal.bg.onclick = function(){\n\t\tmodal.currentUI.kill();\n\t};\n\tmodal.dom.appendChild(modal.bg);\n\n\t// The actual bubble box\n\tmodal.box = document.createElement(\"div\");\n\tmodal.box.id = \"joy-box\";\n\tmodal.box.className = \"arrow_box\";\n\tmodal.dom.appendChild(modal.box);\n\n\t// NO SCROLL\n\tmodal.dom.addEventListener('wheel', function(event){\n\t\tevent.preventDefault();\n\t\treturn false;\n\t});\n\n};\nmodal.show = function(ui){\n\n\tmodal.dom.style.display = \"block\"; // hi\n\n\t// Remember & add UI\n\tmodal.currentUI = ui;\n\tmodal.box.appendChild(ui.dom);\n\t\n\t// Position the Box\n\tvar position = ui.config.position || \"below\";\n\tvar boxBounds = modal.box.getBoundingClientRect();\n\tvar sourceBounds = ui.config.source.getBoundingClientRect();\n\tvar x,y, margin=20;\n\n\t// HACK: IF BELOW & NO SPACE, do LEFT\n\tif(position==\"below\"){\n\t\tvar y = sourceBounds.top + sourceBounds.height + margin; // y: bottom\n\t\tif(y+boxBounds.height > document.body.clientHeight){ // below page!\n\t\t\tposition = \"left\";\n\t\t}\n\t}\n\n\tmodal.box.setAttribute(\"position\", position);\n\tswitch(position){ // TODO: smarter positioning\n\t\tcase \"below\":\n\t\t\tvar x = sourceBounds.left + sourceBounds.width/2; // x: middle\n\t\t\tvar y = sourceBounds.top + sourceBounds.height + margin; // y: bottom\n\t\t\tx -= boxBounds.width/2;\n\t\t\tbreak;\n\t\tcase \"left\":\n\t\t\tvar x = sourceBounds.left - margin; // x: left\n\t\t\tvar y = sourceBounds.top + sourceBounds.height/2; // y: middle\n\t\t\tx -= boxBounds.width;\n\t\t\ty -= boxBounds.height/2;\n\t\t\tbreak;\n\t}\n\tmodal.box.style.left = x + \"px\";\n\tmodal.box.style.top = y + \"px\";\n\n\t// On Open\n\tif(modal.currentUI.config.onopen) modal.currentUI.config.onopen();\n\n};\nmodal.hide = function(){\n\n\t_emptyDOM(modal.box);\n\tmodal.dom.style.display = \"none\"; // bye\n\n\t// On Close\n\tif(modal.currentUI.config.onclose) modal.currentUI.config.onclose();\n\n};\n\n/********************\nChooser's config:\n{\n\tsource: [who this modal dialog should be \"coming from\"]\n\tvalue: [currently selected value, if any]\n\toptions: [label-value pairs],\n\tonchange: function(value){}, // callback \n\tposition: \"below\" // default is \"below\"\n};\n********************/\n\nmodal.Chooser = function(config){\n\n\tvar self = {}; // just an obj to scope this stuff\n\n\t// Config\n\tself.config = config;\n\n\t// Create DOM\n\tvar dom = document.createElement(\"div\");\n\tdom.className = \"joy-modal-chooser\";\n\tself.dom = dom;\n\n\t// Create List DOM\n\tvar list = document.createElement(\"div\");\n\tdom.appendChild(list);\n\n\t// Populate with list of options\n\tself.options = [];\n\tself.categories = {};\n\tvar _placeholder_ = \"_placeholder_\";\n\tvar _makeCategory = function(category){\n\n\t\t// dom\n\t\tvar categoryDOM = document.createElement(\"div\");\n\t\tlist.appendChild(categoryDOM);\n\n\t\t// remember\n\t\tself.categories[category] = categoryDOM;\n\n\t};\n\tself.populate = function(){\n\n\t\t// Create categories, if any!\n\t\tfor(var i=0; i<config.options.length; i++){\n\t\t\tvar option = config.options[i];\n\t\t\tvar category = option.category;\n\t\t\tif(category){\n\t\t\t\t// Category doesn't exist yet... make it!\n\t\t\t\tif(!self.categories[category]) _makeCategory(category);\n\t\t\t}else{\n\t\t\t\t// Make a placholder if not alredy!\n\t\t\t\tif(!self.categories[_placeholder_]) _makeCategory(_placeholder_);\n\t\t\t}\n\t\t}\n\n\t\t// Create options\n\t\tfor(var i=0; i<config.options.length; i++){\n\n\t\t\t// Create option\n\t\t\tvar option = config.options[i];\n\t\t\tvar optionDOM = document.createElement(\"div\");\n\t\t\toptionDOM.innerHTML = option.label;\n\t\t\tif(option.color){\n\t\t\t\toptionDOM.style.color = option.color;\n\t\t\t}\n\n\t\t\t// Put it in its category!\n\t\t\tvar category = option.category || _placeholder_;\n\t\t\tself.categories[category].appendChild(optionDOM);\n\n\t\t\t// On Click!\n\t\t\t(function(option){\n\t\t\t\t// TODO: Hover & preview mode?\n\t\t\t\toptionDOM.onclick = function(event){\n\t\t\t\t\tself.onchange(option.value);\n\t\t\t\t\tevent.stopPropagation(); // no, don't double-fire\n\t\t\t\t};\n\t\t\t})(option);\n\n\t\t}\n\t}\n\tself.populate();\n\n\t// On Select\n\tself.onchange = function(value){\n\t\tself.kill();\n\t\tconfig.onchange(value); // on select AFTER kill, since can create ANOTHER modal\n\t};\n\n\t// Kill & Remove\n\tself.kill = function(){\n\t\tmodal.hide(); // hide modal\n\t};\n\n\t// Show me!\n\tmodal.show(self);\n\n};\n\n/********************\nColor's config:\n{\n\tsource: [who this modal dialog should be \"coming from\"]\n\tvalue: [currently selected value, if any]\n\tonchange: function(value){}, // callback \n\tonclose: function(){}\n};\n********************/\nmodal.Color = function(config){\n\n\tvar self = {}; // just an obj to scope this stuff\n\n\t// Config\n\tself.config = config;\n\n\t// Create DOM\n\tvar dom = document.createElement(\"div\");\n\tdom.className = \"joy-modal-color\";\n\tself.dom = dom;\n\n\t// COLOR is HSV.\n\tconfig.value = config.value || [0,1,1];\n\tself.h = config.value[0];\n\tself.s = config.value[1];\n\tself.v = config.value[2];\n\n\t// THREE ELEMENTS:\n\t// 1. Color Wheel\n\t// 2. Color Value\n\t// 3. Color Pickers\n\n\tvar WHEEL_SIZE = 150;\n\tvar SPECTRUM_WIDTH = 15;\n\tvar MARGIN_1 = 10;\n\tvar MARGIN_2 = 10;\n\tvar MARGIN_3 = 10;\n\n\tvar FULL_WIDTH = MARGIN_1+WHEEL_SIZE+MARGIN_2+SPECTRUM_WIDTH+MARGIN_3;\n\tvar FULL_HEIGHT = MARGIN_1+WHEEL_SIZE+MARGIN_3;\n\n\tself.dom.style.width = FULL_WIDTH + \"px\";\n\tself.dom.style.height = FULL_HEIGHT + \"px\";\n\n\t/////////////////////////////\n\t// 1) The Color Wheel ///////\n\t/////////////////////////////\n\n\tvar wheelCanvas = document.createElement(\"canvas\");\n\twheelCanvas.id = \"joy-color-wheel\";\n\tvar wheelContext = wheelCanvas.getContext(\"2d\");\n\twheelCanvas.width = WHEEL_SIZE*2;\n\twheelCanvas.height = WHEEL_SIZE*2;\n\twheelCanvas.style.width = wheelCanvas.width/2 + \"px\";\n\twheelCanvas.style.height = wheelCanvas.height/2 + \"px\";\n\tdom.appendChild(wheelCanvas);\n\n\twheelCanvas.style.top = MARGIN_1 + \"px\";\n\twheelCanvas.style.left = MARGIN_1 + \"px\";\n\n\tvar _updateWheel = function(){\n\n\t\t// Image Data!\n\t\tvar ctx = wheelContext;\n\t\tctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\t\tvar w = wheelCanvas.width;\n\t\tvar h = wheelCanvas.height;\n\t\tvar image = ctx.createImageData(w,h);\n\t\tvar imageData = image.data;\n\n\t\t// Create a circle of colors\n\t\t// Thanks to: https://medium.com/@bantic/hand-coding-a-color-wheel-with-canvas-78256c9d7d43\n\t\tvar cx = w/2;\n\t\tvar cy = h/2;\n\t\tvar radius = w/2; // buffer for the crosshair\n\t\tvar radiusBuffered = radius + 2; // small buffer for clipping\n\t\tfor(var x=0; x<w; x++){\n\t\t\tfor(var y=0; y<h; y++){\n\t\t\t\tvar dx = x-cx;\n\t\t\t\tvar dy = y-cy;\n\t\t\t\tvar distance = Math.sqrt(dx*dx+dy*dy);\n\t\t\t\tif(distance<radiusBuffered){ // buffer for clipping\n\t\t\t\t\tif(distance>=radius) distance=radius;\n\n\t\t\t\t\t// Angle & Distance, re-mapped to [0,1]\n\t\t\t\t\tvar angle = Math.atan2(dy,dx); // from [-tau/2, tau/2]\n\t\t\t\t\tangle = ((angle/Math.TAU)+0.5)*360; // to [0,360]\n\t\t\t\t\tdistance = (distance/radius); // to [0,1]\n\n\t\t\t\t\t// HSV! (capitals, coz already using 'h')\n\t\t\t\t\tvar H = angle;\n\t\t\t\t\tvar S = distance;\n\t\t\t\t\tvar V = self.v;\n\n\t\t\t\t\t// TO RGB\n\t\t\t\t\tvar rgb = _HSVtoRGB(H,S,V);\n\t\t\t\t\tvar i = (x + (y*w))*4;\n\t\t\t\t\timageData[i] = rgb[0];\n\t\t\t\t\timageData[i+1] = rgb[1];\n\t\t\t\t\timageData[i+2] = rgb[2];\n\t\t\t\t\timageData[i+3] = 255;\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tctx.putImageData(image, 0, 0);\n\n\t\t// Clip it, for aliasing\n\t\tctx.save();\n\t\tctx.globalCompositeOperation = \"destination-in\";\n\t\tctx.beginPath();\n\t\tctx.fillStyle = \"#fff\";\n\t\tctx.arc(cx,cy,radius,0,Math.TAU);\n\t\tctx.fill();\n\t\tctx.restore();\n\n\t};\n\t_updateWheel();\n\n\t/////////////////////////////\n\t// 2) The Value Spectrum ////\n\t/////////////////////////////\n\n\tvar spectrumCanvas = document.createElement(\"canvas\");\n\tspectrumCanvas.id = \"joy-color-value\";\n\tvar spectrumContext = spectrumCanvas.getContext(\"2d\");\n\tspectrumCanvas.width = SPECTRUM_WIDTH*2;\n\tspectrumCanvas.height = WHEEL_SIZE*2;\n\tspectrumCanvas.style.width = spectrumCanvas.width/2 + \"px\";\n\tspectrumCanvas.style.height = spectrumCanvas.height/2 + \"px\";\n\tdom.appendChild(spectrumCanvas);\n\n\tspectrumCanvas.style.top = MARGIN_1 + \"px\";\n\tspectrumCanvas.style.right = MARGIN_3 + \"px\";\n\n\tvar _updateSpectrum = function(){\n\n\t\t// Image data\n\t\tvar ctx = spectrumContext;\n\t\tctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\t\tvar w = spectrumCanvas.width;\n\t\tvar h = spectrumCanvas.height;\n\t\tvar image = ctx.createImageData(w,h);\n\t\tvar imageData = image.data;\n\n\t\t// Just a good ol' spectrum of values\n\t\tfor(var x=0; x<w; x++){\n\t\t\tfor(var y=0; y<h; y++){\n\n\t\t\t\t// HSV! (capitals, coz already using 'h')\n\t\t\t\tvar H = self.h;\n\t\t\t\tvar S = self.s;\n\t\t\t\tvar V = 1-(y/h);\n\n\t\t\t\t// TO RGB\n\t\t\t\tvar rgb = _HSVtoRGB(H,S,V);\n\t\t\t\tvar i = (x + (y*w))*4;\n\t\t\t\timageData[i] = rgb[0];\n\t\t\t\timageData[i+1] = rgb[1];\n\t\t\t\timageData[i+2] = rgb[2];\n\t\t\t\timageData[i+3] = 255;\n\n\t\t\t}\n\t\t}\n\t\tctx.putImageData(image, 0, 0);\n\n\t};\n\t_updateSpectrum();\n\n\t/////////////////////////////\n\t// 3) The Color Pickers /////\n\t/////////////////////////////\n\n\tvar pickerCanvas = document.createElement(\"canvas\");\n\tpickerCanvas.id = \"joy-color-picker\";\n\tvar pickerContext = pickerCanvas.getContext(\"2d\");\n\tpickerCanvas.width = FULL_WIDTH*2;\n\tpickerCanvas.height = FULL_HEIGHT*2;\n\tpickerCanvas.style.width = pickerCanvas.width/2 + \"px\";\n\tpickerCanvas.style.height = pickerCanvas.height/2 + \"px\";\n\tdom.appendChild(pickerCanvas);\n\n\tvar _updatePickers = function(){\n\n\t\t// What's the color?\n\t\tvar x,y;\n\t\tvar ctx = pickerContext;\n\t\tctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\t\tctx.fillStyle = _HSVToRGBString(self.h, self.s, self.v);\n\t\tctx.strokeStyle = \"#fff\";\n\t\tctx.lineWidth = 2;\n\n\t\t// Draw it on the circle\n\t\tvar cx = MARGIN_1*2 + wheelCanvas.width/2;\n\t\tvar cy = MARGIN_1*2 + wheelCanvas.height/2;\n\t\tvar angle = self.h*(Math.TAU/360);\n\t\tvar radius = self.s*(wheelCanvas.width/2);\n\t\tx = cx - Math.cos(angle)*radius;\n\t\ty = cy - Math.sin(angle)*radius;\n\t\tctx.beginPath();\n\t\tctx.arc(x, y, SPECTRUM_WIDTH, 0, Math.TAU);\n\t\tctx.fill();\n\t\tctx.stroke();\n\n\t\t// Draw it on the spectrum\n\t\tvar sx = MARGIN_1*2 + wheelCanvas.width + MARGIN_2*2 + spectrumCanvas.width/2;\n\t\tvar sy = MARGIN_1*2;\n\t\tx = sx;\n\t\ty = sy + spectrumCanvas.height*(1-self.v);\n\t\tctx.beginPath();\n\t\tctx.arc(x, y, SPECTRUM_WIDTH, 0, Math.TAU);\n\t\tctx.fill();\n\t\tctx.stroke();\n\n\t};\n\t_updatePickers();\n\n\t// THE MOUSE EVENTS FOR THE PICKERS\n\tvar editMode;\n\tvar isDragging = false;\n\tvar _update = function(event){\n\n\t\tif(event.target!=pickerCanvas) return; // if outta bounds forget it\n\n\t\tvar x = event.offsetX*2;\n\t\tvar y = event.offsetY*2;\n\t\tif(editMode==\"hs\"){\n\t\t\tx -= MARGIN_1*2;\n\t\t\ty -= MARGIN_1*2;\n\t\t\t_updateHS(x,y);\n\t\t}else{\n\t\t\tx -= MARGIN_1*2 + wheelCanvas.width + MARGIN_2*2;\n\t\t\ty -= MARGIN_1*2;\n\t\t\t_updateV(x,y);\n\t\t}\n\n\t\t// HEY TELL THE SOURCE\n\t\t_updateSource();\n\n\t};\n\tvar _updateHS = function(x,y){\n\n\t\t// get polar\n\t\tvar radius = wheelCanvas.width/2;\n\t\tvar dx = x - radius;\n\t\tvar dy = y - radius;\n\t\tvar angle = Math.atan2(dy, dx);\n\t\tvar distance = Math.sqrt(dx*dx+dy*dy);\n\n\t\t// Re-map\n\t\tangle = ((angle/Math.TAU)+0.5)*360; // to [0,360]\n\t\tif(angle<0) angle=0;\n\t\tif(angle>360) angle=360;\n\t\tdistance = (distance/radius); // to [0,1]\n\t\tif(distance<0) distance=0;\n\t\tif(distance>1) distance=1;\n\n\t\t// update\n\t\tself.h = angle;\n\t\tself.s = distance;\n\t\t_updateSpectrum();\n\t\t_updatePickers();\n\n\t};\n\tvar _updateV = function(x,y){\n\t\tself.v = 1-(y/spectrumCanvas.height);\n\t\tif(self.v<0) self.v=0;\n\t\tif(self.v>1) self.v=1;\n\t\t_updateWheel();\n\t\t_updatePickers();\n\t};\n\tvar _onmousedown = function(event){\n\t\tisDragging = true;\n\t\tif(event.offsetX*2 < MARGIN_1*2 + wheelCanvas.width + MARGIN_2){\n\t\t\teditMode = \"hs\";\n\t\t}else{\n\t\t\teditMode = \"v\";\n\t\t}\n\t\t_update(event);\n\t};\n\tvar _onmousemove = function(event){\n\t\tif(isDragging) _update(event);\n\t};\n\tvar _onmouseup = function(){\n\t\tisDragging = false;\n\t};\n\n\t// MOUSE EVENTS\n\tpickerCanvas.addEventListener(\"mousedown\", _onmousedown);\n\twindow.addEventListener(\"mousemove\", _onmousemove);\n\twindow.addEventListener(\"mouseup\", _onmouseup);\n\n\t// UPDATE SOURCE\n\tvar _updateSource = function(){\n\t\tvar newValue = [self.h, self.s, self.v];\n\t\tnewValue[0] = parseFloat(newValue[0].toFixed(0));\n\t\tnewValue[1] = parseFloat(newValue[1].toFixed(2));\n\t\tnewValue[2] = parseFloat(newValue[2].toFixed(2));\n\t\tconfig.onchange(newValue);\n\t};\n\n\t// Kill\n\tself.kill = function(){\n\t\t\n\t\t// KILL LISTENERS\n\t\tdom.removeEventListener(\"mousedown\", _onmousedown);\n\t\twindow.removeEventListener(\"mousemove\", _onmousemove);\n\t\twindow.removeEventListener(\"mouseup\", _onmouseup);\n\n\t\t// Hide Modal\n\t\tmodal.hide();\n\n\t};\n\n\t// Show me!\n\tmodal.show(self);\n\n}\n\n})();/////////////////////////////////////////\n// FUNDAMENTAL USER INTERACE ACTORS /////\n/////////////////////////////////////////\n\n// TODO: Angle widget\n\n/****************\n\nRaw number widget: JUST the scrubber, no chooser\n\nWidget Options:\n{id:'steps', type:'number', placeholder:10, min:0, max:180, step:1}\n\n****************/\nJoy.add({\n\ttype: \"number\",\n\ttags: [\"ui\"],\n\tinitWidget: function(self){\n\n\t\t// Scrubber IS the DOM\n\t\tvar o = self.options;\n\t\tvar scrubber = new Joy.ui.Scrubber({\n\t\t\tmin: o.min,\n\t\t\tmax: o.max,\n\t\t\tstep: o.step,\n\t\t\tvalue: self.getData(\"value\"),\n\t\t\tonstart: function(){\n\t\t\t\tself.top.activePreview = self;\n\t\t\t},\n\t\t\tonstop: function(){\n\t\t\t\tself.top.activePreview = null;\n\t\t\t},\n\t\t\tonchange: function(value){\n\t\t\t\tself.setData(\"value\", value);\n\t\t\t}\n\t\t});\n\t\tself.dom = scrubber.dom;\n\n\t\t// PREVIEW ON HOVER. WIGGLE IT JUST ONCE.\n\t\t\n\t\tvar _ticker = null;\n\t\tvar _fps = 30;\n\t\tself.dom.onmouseenter = function(){\n\n\t\t\tif(!self.top.canPreview(\"numbers\")) return;\n\t\t\t\n\t\t\t// Create Preview Data\n\t\t\tself.previewData = _clone(self.data);\n\n\t\t\t// Wiggle by 5%... as long as that's not less than 0.5, not more than 2.\n\t\t\tvar _amplitude = Math.abs(self.data.value*0.05);\n\t\t\t//if(_amplitude<0.5) _amplitude=0.5; // TODO: WITH SIGFIG\n\t\t\t//if(_amplitude>3) _amplitude=3;\n\t\t\tif(_amplitude==0) _amplitude=1; // If it's EXACTLY zero, wiggle with 1, whatever.\n\t\t\tvar _timer = 0;\n\t\t\t_ticker = setInterval(function(){\n\n\t\t\t\tif(!self.top.canPreview(\"numbers\")) return _stopPreview(); // don't even\n\n\t\t\t\t_timer += (Math.TAU/_fps)/0.25; // 0.25 seconds\n\t\t\t\tself.previewData.value = self.data.value + Math.sin(_timer)*_amplitude;\n\t\t\t\tself.update();\n\n\t\t\t\tif(_timer>Math.TAU) _stopPreview(); // yer done, son.\n\n\t\t\t},1000/_fps);\n\n\t\t};\n\t\tvar _stopPreview = function(){\n\t\t\tif(_ticker) clearInterval(_ticker);\n\t\t\tself.previewData = null;\n\t\t\tself.update();\n\t\t};\n\t\tself.dom.onmouseleave = _stopPreview;\n\t\t\n\n\t},\n\tonget: function(my){\n\t\treturn my.data.value;\n\t},\n\tplaceholder: {\n\t\tvalue: 3\n\t}\n});\n\n\n/****************\n\nA color widget! (for now, same as choose except paints DOM, too)\n\nWidget Options:\n{id:'direction', type:'choose', options:['left','right'], placeholder:'left'}\n\n****************/\n\nJoy.add({\n\ttype: \"color\",\n\ttags: [\"ui\"],\n\tinitWidget: function(self){\n\n\t\t// Color Button IS the DOM\n\t\tvar colorButton = new Joy.ui.Button({\n\t\t\tlabel: \"&nbsp;\",\n\t\t\tonclick: function(){\n\n\t\t\t\tJoy.modal.Color({ // TODO: precision for those floats, y'know\n\t\t\t\t\tsource: self.dom,\n\t\t\t\t\tvalue: self.getData(\"value\"),\n\t\t\t\t\tonchange: function(value){\n\t\t\t\t\t\tself.setData(\"value\", value);\n\t\t\t\t\t\t_changeLabelColor();\n\t\t\t\t\t},\n\t\t\t\t\tonopen: function(){\n\t\t\t\t\t\tself.top.activePreview = self;\n\t\t\t\t\t},\n\t\t\t\t\tonclose: function(){\n\t\t\t\t\t\tself.top.activePreview = null;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t},\n\t\t\tstyles:[\"joy-color\"]\n\t\t});\n\t\tself.dom = colorButton.dom;\n\n\t\t// Change button color!\n\t\tvar _changeLabelColor = function(){\n\t\t\tvar hsl = self.getData(\"value\");\n\t\t\tcolorButton.dom.style.background = _HSVToRGBString(hsl);\n\t\t};\n\t\t_changeLabelColor();\n\n\t\t// PREVIEW ON HOVER\n\t\t// BOUNCE the HSL Value up & down!\n\t\tvar _ticker = null;\n\t\tvar _fps = 30;\n\t\tvar _initialV, _vel, _timer;\n\t\tself.dom.onmouseenter = function(){\n\n\t\t\tif(!self.top.canPreview(\"numbers\")) return; // yeah let's pretend it's a number\n\t\t\t\n\t\t\t// Create Preview Data\n\t\t\t_initialV = self.data.value[2];\n\t\t\tself.previewData = _clone(self.data);\n\n\t\t\t// Bounce up & down for HALF a second\n\t\t\t_timer = 0;\n\t\t\t_vel = 2*(2/_fps);\n\t\t\t_ticker = setInterval(function(){\n\n\t\t\t\tif(!self.top.canPreview(\"numbers\")) return _stopPreview(); // don't\n\n\t\t\t\t// Bounce up & down\n\t\t\t\tvar hsl = self.previewData.value;\n\t\t\t\thsl[2] += _vel;\n\t\t\t\tif(hsl[2] > 1){\n\t\t\t\t\thsl[2] = 1;\n\t\t\t\t\t_vel *= -1;\n\t\t\t\t}\n\t\t\t\tif(hsl[2] < 0){\n\t\t\t\t\thsl[2] = 0;\n\t\t\t\t\t_vel *= -1;\n\t\t\t\t}\n\t\t\t\tself.update();\n\n\t\t\t\t// Done!\n\t\t\t\t_timer += 2/_fps;\n\t\t\t\tif(_timer>=1) _stopPreview();\n\n\t\t\t},1000/_fps);\n\t\t};\n\t\tvar _stopPreview = function(){\n\t\t\tif(_ticker) clearInterval(_ticker);\n\t\t\tself.previewData = null;\n\t\t\tself.update();\n\t\t};\n\t\tself.dom.onmouseleave = _stopPreview;\n\n\t},\n\tonget: function(my){\n\t\treturn _HSVToRGBString(my.data.value);\n\t},\n\tplaceholder: function(){\n\t\tvar hue = Math.floor(Math.random()*360); // Random color!\n\t\treturn [hue, 0.8, 1.0];\n\t}\n});\n\n\n/****************\n\nA choose-y thing\n\nWidget Options:\n{name:'direction', type:'choose', options:['left','right'], placeholder:'left'}\n// TODO... \"options\" gets overrided soooo UHHHHH.\n\n****************/\nJoy.add({\n\ttype: \"choose\",\n\ttags: [\"ui\"],\n\tinitWidget: function(self){\n\n\t\tvar data = self.data;\n\n\t\t// Options\n\t\tvar options = self.options;\n\t\tfor(var i=0; i<options.length; i++){\n\n\t\t\t// convert to label/value if not already\n\t\t\tvar o = options[i];\n\t\t\tif(!(o.label!==undefined && o.value!==undefined)){\n\t\t\t\toptions[i] = {\n\t\t\t\t\tlabel: o.toString(),\n\t\t\t\t\tvalue: o\n\t\t\t\t};\n\t\t\t}\n\n\t\t}\n\n\t\t// ChooserButton *IS* DOM\n\t\tvar chooserButton = new Joy.ui.ChooserButton({\n\t\t\tvalue: data.value,\n\t\t\toptions: options,\n\t\t\tonchange: function(value){\n\t\t\t\tdata.value = value;\n\t\t\t\tself.update(); // you oughta know!\n\t\t\t},\n\t\t\tstyles: self.styles\n\t\t});\n\t\tself.dom = chooserButton.dom;\n\n\t},\n\tonget: function(my){\n\t\treturn my.data.value;\n\t}\n});\n\n\n/****************\n\nA widget to type in strings!\n\nWidget Options:\n{name:'name', type:'string', prefix:'&ldquo;', suffix:'&rdquo;', color:\"whatever\"}\n\n****************/\nJoy.add({\n\ttype: \"string\",\n\ttags: [\"ui\"],\n\tinitWidget: function(self){\n\n\t\t// String *IS* DOM\n\t\tvar o = self.options;\n\t\tself.stringUI = new Joy.ui.String({\n\t\t\tprefix: o.prefix,\n\t\t\tsuffix: o.suffix,\n\t\t\tcolor: o.color,\n\t\t\tvalue: self.getData(\"value\"),\n\t\t\tonchange: function(value){\n\t\t\t\tself.setData(\"value\", value);\n\t\t\t}\n\t\t});\n\t\tself.dom = self.stringUI.dom;\n\n\t\t// When data's changed, externally\n\t\tself.onDataChange = function(){\n\t\t\tvar value = self.getData(\"value\");\n\t\t\tself.stringUI.setString(value);\n\t\t};\n\n\t},\n\tonget: function(my){\n\t\treturn my.data.value;\n\t},\n\tplaceholder: \"???\"\n});\n\n\n/****************\n\nA widget to save data as hash!\n\nWidget Options:\n{type:'save'} // NO \"id\"! It just saves the top-most data.\n\n****************/\n\nJoy.add({\n\ttype: \"save\",\n\ttags: [\"ui\"],\n\tinitWidget: function(self){\n\n\t\t// DOM\n\t\tvar dom = document.createElement(\"div\");\n\t\tdom.className = \"joy-save\";\n\t\tself.dom = dom;\n\t\t\n\t\t// Save Button\n\t\tself.saveButton = new Joy.ui.Button({\n\t\t\tlabel: \"save:\",\n\t\t\tonclick: function(){\n\t\t\t\t\n\t\t\t\tvar url = Joy.saveToURL(self.top.data);\n\t\t\t\tself.url.setValue(url);\n\t\t\t\tself.url.select();\n\n\t\t\t\t// info\n\t\t\t\tvar chars = url.length;\n\t\t\t\tself.info.innerHTML = \"P.S: you can shorten your link with <a href='http://tinyurl.com/' target='_blank'>TinyURL</a>!\"\n\n\t\t\t}\n\t\t});\n\t\tdom.appendChild(self.saveButton.dom);\n\n\t\t// URL TextBox\n\t\tself.url = new Joy.ui.TextBox({\n\t\t\treadonly: true\n\t\t});\n\t\tdom.appendChild(self.url.dom);\n\n\t\t// Details: chars & tinyurl link\n\t\tself.info = document.createElement(\"div\");\n\t\tself.info.id = \"joy-save-info\";\n\t\tdom.appendChild(self.info);\t\t\n\n\t}\n});\n////////////////////////////////////////////////////////\n// THE BIG ACTOR: A \"PROGRAMMABLE\" LIST OF ACTIONS <3 //\n////////////////////////////////////////////////////////\n\n/****************\n\nA nice list of actions.\n\nWidgetConfig:\n{type:'actions', name:'actions', resetVariables:false}\n\n****************/\nJoy.add({\n\ttype: \"actions\",\n\ttags: [\"ui\"],\n\tinit: function(self){\n\n\t\tif(self.resetVariables!==undefined) self.data.resetVariables=self.resetVariables;\n\n\t\t// TODO: ACTUALLY REFACTOR\n\t\t// TODO: Separate out Actor code from Widget code\n\t\t// so that this can run EVEN WITHOUT WIDGETS.\n\t\t// Using messages, probably.\n\n\t},\n\tinitWidget: function(self){\n\n\t\tvar data = self.data;\n\t\tvar actions = data.actions;\n\n\t\t// DOM\n\t\tvar dom = document.createElement(\"div\");\n\t\tdom.className = \"joy-actions\";\n\t\tself.dom = dom;\n\n\t\t// List\n\t\tvar list = document.createElement(\"list\");\n\t\tlist.id = \"joy-list\";\n\t\tdom.appendChild(list);\n\n\t\t// Preview Variables?\n\t\t/*var varPreview;\n\t\tif(self.top.canPreview(\"variables\")){\n\t\t\tvarPreview = document.createElement(\"div\");\n\t\t\tvarPreview.id = \"joy-variables-preview\";\n\t\t\tvarPreview.innerHTML = \"AHHHH\";\n\t\t\tdom.appendChild(varPreview);\n\t\t}*/\n\n\t\t//////////////////////////////////////////\n\t\t// Create Bullet /////////////////////////\n\t\t//////////////////////////////////////////\n\n\t\tvar bulletOptions = [\n\t\t\t{label:\"Add action above\", value:\"action_above\"},\n\t\t\t{label:\"Add action below\", value:\"action_below\"},\n\t\t\t{label:\"Delete\", value:\"delete\"}\n\t\t];\n\t\tvar _onBulletChoice = function(entry, choice){\n\n\t\t\t// ACTION ABOVE or BELOW\n\t\t\tvar newActionWhere = 0;\n\t\t\tif(choice==\"action_above\") newActionWhere=-1; // above\n\t\t\tif(choice==\"action_below\") newActionWhere=1; // below\n\t\t\tif(newActionWhere!=0){ // not NOT new action\n\t\t\t\t\n\t\t\t\tvar newEntryIndex = self.entries.indexOf(entry);\n\t\t\t\tif(newActionWhere>0) newEntryIndex+=1;\n\n\t\t\t\t// Chooser Modal!\n\t\t\t\tJoy.modal.Chooser({\n\t\t\t\t\tposition: \"left\",\n\t\t\t\t\tsource: entry.bullet.dom,\n\t\t\t\t\toptions: actionOptions,\n\t\t\t\t\tonchange: function(value){\n\t\t\t\t\t\t_addAction(value, newEntryIndex);\n\t\t\t\t\t\tself.update(); // You oughta know!\n\t\t\t\t\t\t_updateBullets(); // update the UI, re-number it.\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t\t// DELETE\n\t\t\tif(choice==\"delete\"){\n\t\t\t\t_removeFromArray(self.entries, entry); // Delete entry from Entries[]\n\t\t\t\t_removeFromArray(actions, entry.actionData); // Delete action from Data's Actions[]\n\t\t\t\tself.removeChild(entry.actor); // Delete actor from Children[]\n\t\t\t\tlist.removeChild(entry.dom); // Delete entry from DOM\n\t\t\t\tself.update(); // You oughta know!\n\t\t\t\t_updateBullets(); // update the UI, re-number it.\n\t\t\t}\n\n\t\t};\n\t\tvar _createBullet = function(entry){\n\t\t\n\t\t\tvar bullet = new Joy.ui.ChooserButton({\n\t\t\t\tposition: \"left\",\n\t\t\t\tstaticLabel: _getBulletLabel(entry),\n\t\t\t\toptions: bulletOptions,\n\t\t\t\tonchange: function(choice){\n\t\t\t\t\t_onBulletChoice(entry, choice);\n\t\t\t\t},\n\t\t\t\tstyles: [\"joy-bullet\"]\n\t\t\t});\n\t\t\tbullet.dom.id = \"joy-bullet\";\n\n\t\t\treturn bullet;\n\n\t\t};\n\n\t\t// Get the digit (or letter, or roman) for this bullet...\n\t\tvar _getBulletLabel = function(entry){\n\n\t\t\t// What index am I?\n\t\t\tvar index = self.entries.indexOf(entry)+1;\n\n\t\t\t// How many levels deep in \"actions\" am I?\n\t\t\tvar levelsDeep = 0;\n\t\t\tvar parent = self.parent;\n\t\t\twhile(parent){\n\t\t\t\tif(parent.type==\"actions\") levelsDeep++;\n\t\t\t\tparent = parent.parent;\n\t\t\t}\n\n\t\t\t// Digit, Letter, or Roman? (Cycle around)\n\t\t\tvar label;\n\t\t\tswitch(levelsDeep%3){\n\t\t\t\tcase 0: label=index; break; // digits\n\t\t\t\tcase 1: label=_numberToAlphabet(index); break; // letter\n\t\t\t\tcase 2: label=_numberToRoman(index); break; // roman\n\t\t\t}\n\n\t\t\treturn label;\n\n\t\t};\n\n\t\t// Re-number ALL these bad boys\n\t\tvar _updateBullets = function(){\n\t\t\tfor(var i=0; i<self.entries.length; i++){\n\t\t\t\tvar entry = self.entries[i];\n\t\t\t\tvar bullet = entry.bullet;\n\t\t\t\tvar label = _getBulletLabel(entry);\n\t\t\t\tbullet.setLabel(label);\n\t\t\t}\n\t\t};\n\n\t\t////////////////////////////////////////////////////////////////////\n\t\t// Add Entry: Entries have a Bullet (the number) & actual widget! //\n\t\t////////////////////////////////////////////////////////////////////\n\n\t\tself.entries = [];\n\t\tvar _addEntry = function(actionData, atIndex){\n\n\t\t\t// New entry\n\t\t\tvar entry = {};\n\t\t\tvar entryDOM = document.createElement(\"div\");\n\t\t\tif(atIndex===undefined) atIndex = self.entries.length;\n\t\t\tself.entries.splice(atIndex, 0, entry);\n\t\t\tlist.insertBefore(entryDOM, list.children[atIndex]);\n\n\t\t\t// The Bullet is a Chooser!\n\t\t\tvar bullet = _createBullet(entry);\n\t\t\tvar bulletContainer = document.createElement(\"div\");\n\t\t\tbulletContainer.id = \"joy-bullet-container\";\n\t\t\tentryDOM.appendChild(bulletContainer);\n\t\t\tbulletContainer.appendChild(bullet.dom);\n\n\t\t\t// New Actor!\n\t\t\tvar newActor = self.addChild({type:actionData.type}, actionData);\n\n\t\t\t// The Widget\n\t\t\tvar newWidget = newActor.createWidget();\n\t\t\tnewWidget.id = \"joy-widget\";\n\t\t\tentryDOM.appendChild(newWidget);\n\n\t\t\t// (Remember all this)\n\t\t\tentry.dom = entryDOM;\n\t\t\tentry.bullet = bullet;\n\t\t\tentry.actor = newActor;\n\t\t\tentry.widget = newWidget;\n\t\t\tentry.actionData = actionData;\n\n\t\t\t// PREVIEW ON HOVER\n\t\t\t// Also tell the action \"_PREVIEW\": how far in the action to go?\n\t\t\tvar _calculatePreviewParam = function(event){\n\t\t\t\tvar param = event.offsetY / bullet.dom.getBoundingClientRect().height;\n\t\t\t\tif(param<0) param=0;\n\t\t\t\tif(param>1) param=1;\n\t\t\t\t_previewAction._PREVIEW = param;\n\t\t\t\tself.update();\n\t\t\t};\n\t\t\tvar _previewAction;\n\t\t\tvar _previewStyle;\n\t\t\tbulletContainer.onmouseenter = function(event){\n\n\t\t\t\tif(!self.top.canPreview(\"actions\")) return;\n\n\t\t\t\tself.top.activePreview = self;\n\t\t\t\t\n\t\t\t\t// Create Preview Data\n\t\t\t\tself.previewData = _clone(self.data);\n\t\t\t\tvar actionIndex = self.entries.indexOf(entry);\n\t\t\t\t_previewAction = self.previewData.actions[actionIndex];\n\n\t\t\t\t// STOP after that action!\n\t\t\t\tself.previewData.actions.splice(actionIndex+1, 0, {STOP:true});\n\n\t\t\t\t// How far to go along action?\n\t\t\t\t_calculatePreviewParam(event);\n\n\t\t\t\t// Add in a style\n\t\t\t\t_previewStyle = document.createElement(\"style\");\n\t\t\t\tdocument.head.appendChild(_previewStyle);\n\t\t\t\t_previewStyle.sheet.insertRule('.joy-actions.joy-previewing > #joy-list > div:nth-child(n+'+(actionIndex+2)+') { opacity:0.1; }');\n\t\t\t\t_previewStyle.sheet.insertRule('.joy-actions.joy-previewing > div.joy-bullet { opacity:0.1; }');\n\t\t\t\tdom.classList.add(\"joy-previewing\");\n\n\t\t\t};\n\t\t\tbulletContainer.onmousemove = function(event){\n\t\t\t\tif(self.previewData) _calculatePreviewParam(event);\n\t\t\t};\n\t\t\tbulletContainer.onmouseleave = function(){\n\t\t\t\tif(self.previewData){\n\t\t\t\t\tself.previewData = null;\n\t\t\t\t\tself.top.activePreview = null;\n\t\t\t\t\tself.update();\n\t\t\t\t\tdocument.head.removeChild(_previewStyle);\n\t\t\t\t\tdom.classList.remove(\"joy-previewing\");\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn entry;\n\n\t\t};\n\t\t// add all INITIAL actions as widgets\n\t\tfor(var i=0;i<actions.length;i++) _addEntry(actions[i]);\n\n\t\t///////////////////////////////////////\n\t\t// Add Action /////////////////////////\n\t\t///////////////////////////////////////\n\n\t\t// Manually add New Action To Actions + Widgets + DOM\n\t\tvar _addAction = function(actorType, atIndex, data={}){ //FG added data\n\t\t\t// Create that new entry & everything\n\t\t\tvar newAction = {type:actorType, ...data};\n\t\t\tif(atIndex===undefined){\n\t\t\t\tactions.push(newAction);\n\t\t\t}else{\n\t\t\t\tactions.splice(atIndex, 0, newAction);\n\t\t\t}\n\t\t\tvar entry = _addEntry(newAction, atIndex);\n\n\t\t\t// Focus on that entry's widget!\n\t\t\t// entry.widget.focus();\n\t\t};\n\t\tself.addAction = _addAction; //FG added\n\n\t\t// Actions you can add:\n\t\t// TODO: INCLUDE ALIASED ACTIONS\n\t\tvar actionOptions = [];\n\t\tif(self.onlyActions){\n\t\t\tfor(var i=0;i<self.onlyActions.length;i++){\n\t\t\t\tvar actionType = self.onlyActions[i];\n\t\t\t\tvar actorTemplate = Joy.getTemplateByType(actionType);\n\t\t\t\tvar notActionTag = actorTemplate.tags.filter(function(tag){\n\t\t\t\t\treturn tag!=\"action\"; // first tag that's NOT \"action\"\n\t\t\t\t})[0];\n\t\t\t\tactionOptions.push({\n\t\t\t\t\tlabel: actorTemplate.name,\n\t\t\t\t\tvalue: actionType,\n\t\t\t\t\tcategory: notActionTag\n\t\t\t\t});\n\t\t\t}\n\t\t}else{\n\t\t\tvar actionActors = Joy.getTemplatesByTag(\"action\");\n\t\t\tfor(var i=0;i<actionActors.length;i++){\n\t\t\t\tvar actionActor = actionActors[i];\n\t\t\t\tvar notActionTag = actionActor.tags.filter(function(tag){\n\t\t\t\t\treturn tag!=\"action\";\n\t\t\t\t})[0];\n\t\t\t\tactionOptions.push({\n\t\t\t\t\tlabel: actionActor.name,\n\t\t\t\t\tvalue: actionActor.type,\n\t\t\t\t\tcategory: notActionTag\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// \"+\" Button: When clicked, prompt what actions to add!\n\t\tvar addButton = new Joy.ui.ChooserButton({\n\t\t\tstaticLabel: \"+\",\n\t\t\toptions: actionOptions,\n\t\t\tonchange: function(value){\n\t\t\t\t_addAction(value);\n\t\t\t\tself.update(); // You oughta know!\n\t\t\t},\n\t\t\tstyles: [\"joy-bullet\"]\n\t\t});\n\t\tdom.appendChild(addButton.dom);\n\n\t},\n\tonact: function(my){\n\n\t\t// Create _vars, if not already there\n\t\tif(!my.target._variables) my.target._variables={}; \n\n\t\t// Reset all of target's variables?\n\t\tif(my.data.resetVariables) my.target._variables = {};\n\n\t\t// Do those actions, baby!!!\n\t\tfor(var i=0; i<my.data.actions.length; i++){\n\n\t\t\t// Stop?\n\t\t\tvar actionData = my.data.actions[i];\n\t\t\tif(actionData.STOP) return \"STOP\";\n\n\t\t\t// Run \n\t\t\tvar actor = my.actor.entries[i].actor; // TODO: THIS IS A HACK AND SHOULD NOT RELY ON THAT\n\t\t\tvar actorMessage = actor.act(my.target, actionData); // use ol' actor, but GIVEN data.\n\t\t\tif(actorMessage==\"STOP\") return actorMessage;\n\n\t\t}\n\n\t},\n\tplaceholder: {\n\t\tactions: [],\n\t\tresetVariables: true\n\t}\n});\n/////////////////////////////////////////\n// LOGIC ACTORS /////////////////////////\n/////////////////////////////////////////\n\nJoy.module(\"instructions\", function(){\n\n\tJoy.add({\n\t\tname: \"Repeat the following...\",\n\t\ttype: \"instructions/repeat\",\n\t\ttags: [\"instructions\", \"action\"],\n\t\tinit: \"Repeat the following {id:'count', type:'number', min:1, placeholder:3} times: \"+\n\t\t\t  \"{id:'actions', type:'actions', resetVariables:false}\",\n\t\tonact: function(my){\n\t\t\t\n\t\t\t// Previewing? How much to preview?\n\t\t\tvar param = 1;\n\t\t\tif(my.data._PREVIEW!==undefined) param=my.data._PREVIEW;\n\n\t\t\t// Loop through it... (as far as preview shows, anyway)\n\t\t\tvar loops = Math.floor(my.data.count*param);\n\t\t\tfor(var i=0; i<loops; i++){\n\t\t\t\tvar message = my.actor.actions.act(my.target);\n\t\t\t\tif(message==\"STOP\") return message; // STOP\n\t\t\t}\n\n\t\t}\n\t});\n\n\t/*Joy.add({\n\t\tname: \"If... then...\",\n\t\ttype: \"instructions/if\",\n\t\ttags: [\"instructions\", \"action\"],\n\t\tinit: \"If AHHH, then: \"+\n\t\t\t  \"{id:'actions', type:'actions', resetVariables:false}\",\n\t\tonact: function(my){\n\t\t\tvar message = my.actor.actions.act(my.target);\n\t\t\tif(message==\"STOP\") return message; // STOP\n\t\t}\n\t});*/\n\n\tJoy.add({\n\t\tname: \"// Write a note\",\n\t\ttype: \"instructions/comment\",\n\t\ttags: [\"instructions\", \"action\"],\n\t\tinitWidget: function(self){\n\n\t\t\t// DOM\n\t\t\tself.dom = document.createElement(\"div\");\n\n\t\t\t// Comment Box\n\t\t\tself.box = new Joy.ui.TextBox({\n\t\t\t\tmultiline: true,\n\t\t\t\tplaceholder: \"// your notes here\",\n\t\t\t\tvalue: self.getData(\"value\"),\n\t\t\t\tonchange: function(value){\n\t\t\t\t\tself.setData(\"value\", value);\n\t\t\t\t},\n\t\t\t\tstyles: [\"box\"]\n\t\t\t});\n\t\t\tself.dom.appendChild(self.box.dom);\n\n\t\t}\n\t});\n\n});\n// VARIABLE NAME: you're just a synchronized string, yo.\nJoy.add({\n\ttype: \"variableName\",\n\ttags: [\"ui\"],\n\tinit: function(self){\n\n\t\tvar variableType = self.variableType;\n\n\t\t// Unique Variable Name\n\t\tvar _uniqueVariableName = function(){\n\t\t\tvar varnames = Joy.getReferencesByTag(self, variableType).map(function(ref){\n\t\t\t\treturn ref.data.value;\n\t\t\t});\n\t\t\tvar highestCount=0;\n\t\t\tvarnames.forEach(function(varname){\n\t\t\t\tvar num;\n\t\t\t\tif(varname==\"thing\") num=1; // at least 1\n\t\t\t\tvar match = varname.match(/thing\\s(\\d+)/);\n\t\t\t\tif(match) num = parseInt(match[1]); // or more\n\t\t\t\tif(highestCount<num) highestCount=num;\n\t\t\t});\n\t\t\tif(highestCount==0) return \"thing\";\n\t\t\telse return \"thing \"+(highestCount+1);\n\t\t};\n\n\t\t// Create Reference method\n\t\tself._createNewReference = function(){\n\t\t\tvar refData = {\n\t\t\t\tvalue: _uniqueVariableName(),\n\t\t\t\tcolor: _randomHSV()\n\t\t\t};\n\t\t\tvar ref = Joy.createReference(self, variableType, refData);\n\t\t\tself.setData(\"refID\", ref.id, true); // Remember Ref ID. And DON'T update.\n\t\t\tJoy.connectReference(self, ref.id); // connect new ref\n\t\t};\n\n\t\t// Do I already have a reference? Create one if no.\n\t\tvar refID = self.getData(\"refID\");\n\t\tif(refID){\n\t\t\tJoy.connectReference(self, refID); // connect this ref\n\t\t}else{\n\n\t\t\t// Well, first try seeing if there are any vars.\n\t\t\t// If so, connect to most recently created one\n\t\t\tvar varReferences = Joy.getReferencesByTag(self, variableType);\n\t\t\t// CONFIG: self.startWithExisting!\n\t\t\tif(self.startWithExisting && varReferences.length>0){\n\t\t\t\tvar latestReference = varReferences[varReferences.length-1];\n\t\t\t\trefID = latestReference.id;\n\t\t\t\tself.setData(\"refID\", refID, true); // set data\n\t\t\t\tJoy.connectReference(self, refID); // connect this ref\n\t\t\t}else{\n\t\t\t\t// Otherwise, make a new one!\n\t\t\t\tself._createNewReference();\n\t\t\t}\n\t\t\t\n\t\t}\n\n\t\t// Switch reference \n\t\tself._switchReference = function(newRefID){\n\t\t\tvar refID = self.getData(\"refID\");\n\t\t\tJoy.disconnectReference(self, refID); // disconnect old ref\n\t\t\tself.setData(\"refID\", newRefID); // DO update this!\n\t\t\tJoy.connectReference(self, newRefID); // connect new ref\n\t\t};\n\n\t},\n\tinitWidget: function(self){\n\n\t\tself.dom = document.createElement(\"span\");\n\t\t\n\t\t// The String edits my REFERENCE'S data.\n\t\tvar refID = self.getData(\"refID\");\n\t\tvar refData = Joy.getReferenceById(self, refID).data;\n\t\tvar stringActor = self.addChild({\n\t\t\ttype: \"string\",\n\t\t\tprefix:\"[\", suffix:\"]\",\n\t\t\tcolor: refData.color\n\t\t}, refData);\n\t\tvar stringWidget = stringActor.createWidget();\n\t\tself.dom.appendChild(stringWidget);\n\n\t\t// This String Actor also updates its color\n\t\tvar _old_stringActor_onDataChange = stringActor.onDataChange;\n\t\tstringActor.onDataChange = function(){\n\t\t\t_old_stringActor_onDataChange();\n\t\t\tvar color = stringActor.getData(\"color\");\n\t\t\tstringActor.stringUI.setColor(color);\n\t\t};\n\n\t\t// Chooser? Can choose to switch to other variables (or make new one)\n\t\tvar variableType = self.variableType;\n\t\tvar _showChooser = function(){\n\n\t\t\tvar options = [];\n\n\t\t\t// Get all references that are of this type\n\t\t\tvar refs = Joy.getReferencesByTag(self, variableType);\n\t\t\tvar myRefID = self.getData(\"refID\");\n\t\t\trefs.forEach(function(ref){\n\t\t\t\tif(ref.id==myRefID) return; // don't show SELF\n\t\t\t\tvar color = ref.data.color;\n\t\t\t\tcolor = _HSVToRGBString(color[0], color[1], color[2]);\n\t\t\t\toptions.push({\n\t\t\t\t\tlabel: \"[\"+ref.data.value+\"]\",\n\t\t\t\t\tvalue: ref.id,\n\t\t\t\t\tcolor: color\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// Meta Options:\n\t\t\toptions.push({\n\t\t\t\tcategory: \"meta\",\n\t\t\t\tlabel: \"(+new)\",\n\t\t\t\tvalue: \"NEW\"\n\t\t\t});\n\t\t\toptions.push({\n\t\t\t\tcategory: \"meta\",\n\t\t\t\tlabel: \"(change color)\",\n\t\t\t\tvalue: \"CHANGE_COLOR\"\n\t\t\t});\n\n\t\t\t// Show all possible variables!\n\t\t\tJoy.modal.Chooser({\n\t\t\t\tsource: self.dom,\n\t\t\t\toptions: options,\n\t\t\t\tonchange: function(newRefID){\n\n\t\t\t\t\tif(newRefID==\"CHANGE_COLOR\"){\n\n\t\t\t\t\t\t// Just change color, ha.\n\t\t\t\t\t\tJoy.modal.Color({\n\t\t\t\t\t\t\tsource: self.dom,\n\t\t\t\t\t\t\tvalue: stringActor.getData(\"color\"),\n\t\t\t\t\t\t\tonchange: function(newColor){\n\t\t\t\t\t\t\t\tstringActor.setData(\"color\", newColor);\n\t\t\t\t\t\t\t\tstringActor.stringUI.setColor(newColor); // do this again coz edit lock\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t}else{\n\n\t\t\t\t\t\t// Make a new reference? Either way, set refID\n\t\t\t\t\t\tif(newRefID==\"NEW\"){\n\t\t\t\t\t\t\tvar oldRefID = self.getData(\"refID\");\n\t\t\t\t\t\t\tJoy.disconnectReference(self, oldRefID); // disconnect old ref\n\t\t\t\t\t\t\tself._createNewReference();\n\t\t\t\t\t\t\tself.update(); // update, yo\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tself._switchReference(newRefID);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Make String Widget edit that instead\n\t\t\t\t\t\tvar refID = self.getData(\"refID\");\n\t\t\t\t\t\tvar ref = Joy.getReferenceById(self, refID);\n\t\t\t\t\t\tstringActor.switchData(ref.data);\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t});\n\n\t\t};\n\n\t\t// Show ON CLICK!\n\t\tif(!self.noChooser){\n\t\t\tself.dom.onclick = _showChooser;\n\t\t}\n\t\t\n\t},\n\tonget: function(my){\n\t\tvar refID = my.data.refID;\n\t\tvar ref = Joy.getReferenceById(my.actor, refID);\n\t\treturn ref.data.value; // returns the variable name\n\t},\n\tonkill: function(self){\n\t\t\n\t\t// Disconnect any references I may have\n\t\tvar refID = self.getData(\"refID\");\n\t\tJoy.disconnectReference(self, refID); // disconnect old ref\n\n\t}\n});/////////////////////////////////////////\n// MATH ACTORS //////////////////////////\n/////////////////////////////////////////\n\nJoy.module(\"math\", function(){\n\n\t/*********************\n\n\tAlright. This is gonna be a big one.\n\tIt needs to be able to chain math elements,\n\tand each element needs to be able to switch between\n\tscrubbers, variables, and other number-getter actors.\n\n\tData:\n\t{\n\t\ttype: \"number\",\n\t\tchain:[\n\t\t\t{type:\"number_raw\", value:3},\n\t\t\t{type:\"choose\", value:\"*\"},\n\t\t\t{type:\"variableName\", refID:whatever},\n\t\t\t{type:\"choose\", value:\"+\"},\n\t\t\t{type:\"turtle/getAngle\"}\n\t\t]\n\t}\n\n\t*********************/\n\tJoy.modify(\"number\", \"number_raw\", function(_old){\n\t\treturn {\n\t\t\tinit: function(self){\n\n\t\t\t\t// no variables?\n\t\t\t\tif(self.noVariables) return;\n\n\t\t\t\t// Force data to a chain...\n\t\t\t\tvar originalValue = self.getData(\"value\");\n\t\t\t\tif(typeof originalValue===\"number\"){\n\t\t\t\t\tself.setData(\"value\",undefined,true); // delete \"value\", no update\n\t\t\t\t\tself.setData(\"chain\",[\n\t\t\t\t\t\t{type:\"number_raw\", value:originalValue}\n\t\t\t\t\t],true); // create \"chain\", no update\n\t\t\t\t}\n\n\t\t\t\t// MAKE A NEW CHAIN ACTOR *AND DATA(?)*\n\t\t\t\tself._makeNewChainActor = function(chainItem, atIndex){\n\n\t\t\t\t\t// Make it\n\t\t\t\t\tvar chainActor;\n\t\t\t\t\tvar type = chainItem.type;\n\t\t\t\t\tvar options = {};\n\t\t\t\t\tvar isFirst = (atIndex === undefined) ? (self.chainActors.length == 0) : (atIndex == 0); \n\t\t\t\t\tif (isFirst && self.options !== undefined) {\n\t\t\t\t\t\toptions.min = self.options.min;\n\t\t\t\t\t\toptions.max = self.options.max;\n\t\t\t\t\t}\n\t\t\t\t\tswitch(type){\n\n\t\t\t\t\t\t// Elements\n\t\t\t\t\t\tcase \"number_raw\":\n\t\t\t\t\t\t\tchainActor = self.addChild({type:type, ...options}, chainItem);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"variableName\":\n\t\t\t\t\t\t\tchainActor = self.addChild({\n\t\t\t\t\t\t\t\ttype: type,\n\t\t\t\t\t\t\t\tvariableType: 'number',\n\t\t\t\t\t\t\t\tnoChooser: true\n\t\t\t\t\t\t\t}, chainItem);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t// Operand\n\t\t\t\t\t\tcase \"choose\":\n\t\t\t\t\t\t\tchainActor = self.addChild({\n\t\t\t\t\t\t\t\ttype:type, \n\t\t\t\t\t\t\t\toptions:[\n\t\t\t\t\t\t\t\t\t{ label:\"+\", value:\"+\" },\n\t\t\t\t\t\t\t\t\t{ label:\"-\", value:\"-\" }, \n\t\t\t\t\t\t\t\t\t{ label:\"&times;\", value:\"*\" },\n\t\t\t\t\t\t\t\t\t{ label:\"&divide;\", value:\"/\" }\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\tstyles: [\"joy-math\"]\n\t\t\t\t\t\t\t}, chainItem);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Add or splice to Chain Actors array! *AND THE DATA*\n\t\t\t\t\tvar chain = self.getData(\"chain\");\n\t\t\t\t\tif(atIndex!==undefined){\n\t\t\t\t\t\tself.chainActors.splice(atIndex, 0, chainActor);\n\t\t\t\t\t\tchain.splice(atIndex, 0, chainItem);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tself.chainActors.push(chainActor);\n\t\t\t\t\t\tchain.push(chainItem);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Return\n\t\t\t\t\treturn chainActor;\n\n\t\t\t\t}\n\n\t\t\t\t// Create an actor for each element in the chain\n\t\t\t\tself.chainActors = []; // keep a chain parallel to children. this one's in ORDER.\n\t\t\t\tvar realChain = self.getData(\"chain\");\n\t\t\t\tvar chain = _clone(realChain);\n\t\t\t\trealChain.splice(0, realChain.length); // empty out realChain\n\t\t\t\tfor(var i=0; i<chain.length; i++){\n\t\t\t\t\tself._makeNewChainActor(chain[i]);\n\t\t\t\t}\n\n\t\t\t\t// REPLACE A CHAIN ACTOR *AND DATA*\n\t\t\t\tself._replaceChainActor = function(oldChainActor, newItem){\n\n\t\t\t\t\t// Delete old actor, and add new actor where it was\n\t\t\t\t\tvar oldIndex = self._deleteChainActor(oldChainActor);\n\t\t\t\t\tvar newChainActor = self._makeNewChainActor(newItem, oldIndex);\n\n\t\t\t\t\t// update manually!\n\t\t\t\t\tself.update();\n\n\t\t\t\t\t// Return\n\t\t\t\t\treturn newChainActor;\n\n\t\t\t\t};\n\n\t\t\t\t// DELETE A CHAIN ACTOR *AND DATA*\n\t\t\t\tself._deleteChainActor = function(chainActor){\n\n\t\t\t\t\t// Delete actor\n\t\t\t\t\tvar oldIndex = self.chainActors.indexOf(chainActor);\n\t\t\t\t\t_removeFromArray(self.chainActors, chainActor);\n\t\t\t\t\tself.removeChild(chainActor);\n\n\t\t\t\t\t// and data!\n\t\t\t\t\tvar chain = self.getData(\"chain\");\n\t\t\t\t\tchain.splice(oldIndex, 1);\n\n \t\t\t\t\t// so can re-use index\n\t\t\t\t\treturn oldIndex;\n\n\t\t\t\t};\n\n\t\t\t},\n\t\t\tinitWidget: function(self){\n\n\t\t\t\t// no variables?\n\t\t\t\tif(self.noVariables){\n\t\t\t\t\t_old.initWidget(self);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Container!\n\t\t\t\tself.dom = document.createElement(\"span\");\n\t\t\t\tself.dom.className = \"joy-number\";\n\n\t\t\t\t// Show Chooser!\n\t\t\t\tvar _showChooser = function(chainActor){\n\n\t\t\t\t\tvar options = [];\n\n\t\t\t\t\t// Show placeholder number (unless i'm a number_raw, or there isn't one)\n\t\t\t\t\tif(chainActor.type!=\"number_raw\"){\n\t\t\t\t\t\tvar placeholderNumber = self.placeholder.value;\n\t\t\t\t\t\tif(typeof placeholderNumber===\"number\"){\n\t\t\t\t\t\t\toptions.push({\n\t\t\t\t\t\t\t\tlabel: placeholderNumber,\n\t\t\t\t\t\t\t\tvalue: {\n\t\t\t\t\t\t\t\t\ttype: \"number_raw\",\n\t\t\t\t\t\t\t\t\tvalue: placeholderNumber\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Show possible variables (except the current variable)\n\t\t\t\t\tvar refs = Joy.getReferencesByTag(self, \"number\");\n\t\t\t\t\tvar myRefID;\n\t\t\t\t\tif(chainActor.type==\"variableName\") myRefID=chainActor.getData(\"refID\");\n\t\t\t\t\trefs.forEach(function(ref){\n\t\t\t\t\t\tif(ref.id==myRefID) return; // don't show SELF\n\t\t\t\t\t\tvar color = ref.data.color;\n\t\t\t\t\t\tcolor = _HSVToRGBString(color[0], color[1], color[2]);\n\t\t\t\t\t\toptions.push({\n\t\t\t\t\t\t\tlabel: \"[\"+ref.data.value+\"]\",\n\t\t\t\t\t\t\tvalue: {\n\t\t\t\t\t\t\t\ttype: \"variableName\",\n\t\t\t\t\t\t\t\trefID: ref.id\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcolor: color\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t// Show all these dang options!\n\t\t\t\t\tif(options.length>0){\n\t\t\t\t\t\tJoy.modal.Chooser({\n\t\t\t\t\t\t\tsource: chainActor.dom,\n\t\t\t\t\t\t\toptions: options,\n\t\t\t\t\t\t\tonchange: function(newItem){\n\t\t\t\t\t\t\t\t// REPLACE CHAIN ACTOR & ENTRY\n\t\t\t\t\t\t\t\tvar newChainActor = self._replaceChainActor(chainActor, newItem);\n\t\t\t\t\t\t\t\tself._replaceChainEntry(chainActor, newChainActor);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t};\n\n\t\t\t\t// THE WAY TO ORGANIZE THIS: ENTRIES that have DOM *and* ACTOR\n\t\t\t\tself._chainEntries = [];\n\n\t\t\t\t// MAKE CHAIN ENTRY\n\t\t\t\tself._makeChainEntry = function(chainActor, atIndex){\n\n\t\t\t\t\t// Widget\n\t\t\t\t\tvar widget = document.createElement(\"span\");\n\t\t\t\t\tchainActor.createWidget();\n\t\t\t\t\twidget.appendChild(chainActor.dom);\n\n\t\t\t\t\t// Widget chooser, if NOT an operand\n\t\t\t\t\tif(chainActor.type!=\"choose\"){\n\t\t\t\t\t\tvar entry;\n\t\t\t\t\t\tvar moreButton = new Joy.ui.Button({\n\t\t\t\t\t\t\tonclick: function(){\n\t\t\t\t\t\t\t\t_showChainOptions(entry);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tstyles: [\"joy-more\"]\n\t\t\t\t\t\t});\n\t\t\t\t\t\twidget.appendChild(moreButton.dom);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Place in widget\n\t\t\t\t\tif(atIndex!==undefined){\n\t\t\t\t\t\tif(atIndex < self.dom.childNodes.length){\n\t\t\t\t\t\t\t// replacing NOT at last child...\n\t\t\t\t\t\t\tvar beforeThisWidget = self.dom.childNodes[atIndex];\n\t\t\t\t\t\t\tself.dom.insertBefore(widget, beforeThisWidget);\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t// Otherwise just append\n\t\t\t\t\t\t\tself.dom.appendChild(widget);\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{\n\t\t\t\t\t\tself.dom.appendChild(widget);\n\t\t\t\t\t}\n\n\t\t\t\t\t// If it's NOT an operand, clicking it reveals options\n\t\t\t\t\tif(chainActor.type!=\"choose\"){\n\t\t\t\t\t\t(function(ca){\n\t\t\t\t\t\t\t// HACK: click, NOT scrub. detect w/ time frame\n\t\t\t\t\t\t\tvar _mouseDownTime;\n\t\t\t\t\t\t\tca.dom.addEventListener(\"mousedown\", function(){\n\t\t\t\t\t\t\t\t_mouseDownTime = +(new Date());\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tca.dom.addEventListener(\"mouseup\", function(){\n\t\t\t\t\t\t\t\tvar _time = +(new Date());\n\t\t\t\t\t\t\t\tif(_time-_mouseDownTime < 500){\n\t\t\t\t\t\t\t\t\t_showChooser(ca); // if clicked in less than a half second\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})(chainActor);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Entry\n\t\t\t\t\tentry = {\n\t\t\t\t\t\twidget: widget,\n\t\t\t\t\t\tactor: chainActor\n\t\t\t\t\t};\n\t\t\t\t\tif(atIndex!==undefined){\n\t\t\t\t\t\tself._chainEntries.splice(atIndex, 0, entry);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tself._chainEntries.push(entry);\n\t\t\t\t\t}\n\n\t\t\t\t};\n\n\t\t\t\t// DELETE CHAIN ENTRY\n\t\t\t\tself._deleteChainEntry = function(chainActor){\n\n\t\t\t\t\t// Get index (so can return later)\n\t\t\t\t\tvar entry = self._chainEntries.find(function(entry){\n\t\t\t\t\t\treturn entry.actor == chainActor;\n\t\t\t\t\t});\n\t\t\t\t\tvar index = self._chainEntries.indexOf(entry);\n\n\t\t\t\t\t// Delete widget & entry (actor's already been deleted)\n\t\t\t\t\tvar widget = entry.widget;\n\t\t\t\t\tself.dom.removeChild(widget);\n\t\t\t\t\t_removeFromArray(self._chainEntries, entry);\n\n\t\t\t\t\t// Index?\n\t\t\t\t\treturn index;\n\n\t\t\t\t};\n\n\t\t\t\t// REPLACE CHAIN ENTRY\n\t\t\t\tself._replaceChainEntry = function(oldChainActor, newChainActor){\n\t\t\t\t\tvar oldIndex = self._deleteChainEntry(oldChainActor);\t\t\t\t\t\n\t\t\t\t\tself._makeChainEntry(newChainActor, oldIndex);\n\t\t\t\t};\n\n\t\t\t\t// SHOW CHAIN OPTIONS\n\t\t\t\tvar _showChainOptions = function(entry){\n\n\t\t\t\t\t// Possible operands\n\t\t\t\t\tvar currentLabel = entry.widget.innerText;\n\t\t\t\t\tvar options = [\n\t\t\t\t\t\t{label:currentLabel+\" + 2\", value:\"+\"},\n\t\t\t\t\t\t{label:currentLabel+\" - 2\", value:\"-\"},\n\t\t\t\t\t\t{label:currentLabel+\" &times; 2\", value:\"*\"},\n\t\t\t\t\t\t{label:currentLabel+\" &divide; 2\", value:\"/\"}\n\t\t\t\t\t];\n\n\t\t\t\t\t// To delete... which operand?\n\t\t\t\t\tvar elementIndex = self._chainEntries.indexOf(entry);\n\t\t\t\t\tif(self._chainEntries.length>1){ // can't delete if just one\n\t\t\t\t\t\t\n\t\t\t\t\t\t// The operand...\n\t\t\t\t\t\tvar operandIndex;\n\t\t\t\t\t\tif(elementIndex==0) operandIndex=elementIndex+1; // first\n\t\t\t\t\t\telse operandIndex=elementIndex-1; // not\n\n\t\t\t\t\t\t// Label\n\t\t\t\t\t\tvar label;\n\t\t\t\t\t\tvar operandLabel = self._chainEntries[operandIndex].widget.innerText;\n\t\t\t\t\t\tif(elementIndex==0) label = currentLabel+\" \"+operandLabel; // first\n\t\t\t\t\t\telse label = operandLabel+\" \"+currentLabel; // not\n\n\t\t\t\t\t\t// Indices to delete\n\t\t\t\t\t\tvar indicesToDelete = [elementIndex, operandIndex].sort(); // increasing order\n\n\t\t\t\t\t\t// Push option!\n\t\t\t\t\t\toptions.push({\n\t\t\t\t\t\t\tcategory: \"meta\",\n\t\t\t\t\t\t\tlabel: '(delete “'+label+'”)',\n\t\t\t\t\t\t\tvalue: indicesToDelete\n\t\t\t\t\t\t});\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Choose options!\n\t\t\t\t\tJoy.modal.Chooser({\n\t\t\t\t\t\tsource: entry.widget,\n\t\t\t\t\t\toptions: options,\n\t\t\t\t\t\tonchange: function(operand){\n\n\t\t\t\t\t\t\t// It's an operand...\n\t\t\t\t\t\t\tif(typeof operand===\"string\"){\n\n\t\t\t\t\t\t\t\t// Get index of the actor...\n\t\t\t\t\t\t\t\tvar index = self._chainEntries.indexOf(entry);\n\n\t\t\t\t\t\t\t\t// Make the OPERAND actor(+data) & entry\n\t\t\t\t\t\t\t\tindex++;\n\t\t\t\t\t\t\t\tvar operandActor = self._makeNewChainActor({type:\"choose\", value:operand}, index);\n\t\t\t\t\t\t\t\tself._makeChainEntry(operandActor, index);\n\n\t\t\t\t\t\t\t\t// Make the NUMBER actor(+data) & entry (just the number 2, why hot)\n\t\t\t\t\t\t\t\tindex++;\n\t\t\t\t\t\t\t\tvar numberActor = self._makeNewChainActor({type:\"number_raw\", value:2}, index);\n\t\t\t\t\t\t\t\tself._makeChainEntry(numberActor, index);\n\n\t\t\t\t\t\t\t}else{\n\n\t\t\t\t\t\t\t\t// Otherwise, DELETE ACTOR & ENTRY!\n\t\t\t\t\t\t\t\tvar indices = operand;\n\t\t\t\t\t\t\t\tfor(var i=indices.length-1; i>=0; i--){ // flip around coz DELETING\n\t\t\t\t\t\t\t\t\tvar indexToDelete = indices[i];\n\t\t\t\t\t\t\t\t\tvar actorToDelete = self._chainEntries[indexToDelete].actor;\n\t\t\t\t\t\t\t\t\tself._deleteChainActor(actorToDelete);\n\t\t\t\t\t\t\t\t\tself._deleteChainEntry(actorToDelete);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Update!\n\t\t\t\t\t\t\tself.update();\n\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t};\n\n\t\t\t\t// For each chain actor, put in that entry\n\t\t\t\tfor(var i=0; i<self.chainActors.length; i++){\n\t\t\t\t\tvar chainActor = self.chainActors[i];\n\t\t\t\t\tself._makeChainEntry(chainActor);\n\t\t\t\t}\n\n\t\t\t},\n\t\t\tonget: function(my){\n\n\t\t\t\t// no variables?\n\t\t\t\tif(my.actor.noVariables){\n\t\t\t\t\treturn _old.onget(my);\n\t\t\t\t}\n\n\t\t\t\t////////////////\n\n\t\t\t\tvar nums_and_ops = []; // just gets chain of nums & ops\n\n\t\t\t\t// EVALUATE EACH ELEMENT FIRST\n\t\t\t\tfor(var i=0; i<my.data.chain.length; i+=2){\n\n\t\t\t\t\t// Synched indices!\n\t\t\t\t\tvar chainActor = my.actor.chainActors[i]; \n\n\t\t\t\t\t// Evaluate element\n\t\t\t\t\tvar num;\n\t\t\t\t\tswitch(chainActor.type){\n\t\t\t\t\t\tcase \"number_raw\":\n\t\t\t\t\t\t\tnum = chainActor.get(my.target);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase \"variableName\":\n\t\t\t\t\t\t\tvar _variables = my.target._variables;\n\t\t\t\t\t\t\tvar varname = chainActor.get(my.target); // it's just a synchronized string\n\t\t\t\t\t\t\tnum = _variables[varname];\n\t\t\t\t\t\t\tbreak; \n\t\t\t\t\t}\n\n\t\t\t\t\t// Any operator before it?\n\t\t\t\t\tif(i>0){\n\t\t\t\t\t\tvar operandActor = my.actor.chainActors[i-1];\n\t\t\t\t\t\tvar op = operandActor.get();\n\t\t\t\t\t\tnums_and_ops.push(op);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Push num\n\t\t\t\t\tnums_and_ops.push(num);\n\n\t\t\t\t}\n\n\t\t\t\t// MULTIPLICATION AND DIVISION FIRST. LEFT-ASSOCIATIVE\n\t\t\t\tfor(var i=1; i<nums_and_ops.length; i+=2){\n\n\t\t\t\t\tvar op = nums_and_ops[i];\n\t\t\t\t\tif(op==\"*\" || op==\"/\"){\n\n\t\t\t\t\t\t// Do math to the two numbers\n\t\t\t\t\t\tvar num1 = nums_and_ops[i-1];\n\t\t\t\t\t\tvar num2 = nums_and_ops[i+1];\n\t\t\t\t\t\tvar res;\n\t\t\t\t\t\tif(op==\"*\") res = num1*num2;\n\t\t\t\t\t\telse res = num1/num2;\n\n\t\t\t\t\t\t// Modify array, and set index back\n\t\t\t\t\t\t// remove 3 items: num1, op, num2\n\t\t\t\t\t\t// replace with 1 item: result\n\t\t\t\t\t\tnums_and_ops.splice(i-1, 3, res);\n\t\t\t\t\t\ti-=2;\n\n\t\t\t\t\t}else{\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// NOW DO ADDITION AND SUBTRACTION\n\t\t\t\tfor(var i=1; i<nums_and_ops.length; i+=2){\n\n\t\t\t\t\tvar op = nums_and_ops[i];\n\t\t\t\t\tif(op==\"+\" || op==\"-\"){\n\n\t\t\t\t\t\t// Do math to the two numbers\n\t\t\t\t\t\tvar num1 = nums_and_ops[i-1];\n\t\t\t\t\t\tvar num2 = nums_and_ops[i+1];\n\t\t\t\t\t\tvar res;\n\t\t\t\t\t\tif(op==\"+\") res = num1+num2;\n\t\t\t\t\t\telse res = num1-num2;\n\n\t\t\t\t\t\t// Modify array, and set index back\n\t\t\t\t\t\t// remove 3 items: num1, op, num2\n\t\t\t\t\t\t// replace with 1 item: result\n\t\t\t\t\t\tnums_and_ops.splice(i-1, 3, res);\n\t\t\t\t\t\ti-=2;\n\n\t\t\t\t\t}else{\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\treturn nums_and_ops[0];\n\n\t\t\t}\n\t\t};\n\t});\n\n\t/****************\n\n\tSet a variable to some number.\n\n\t****************/\n\tJoy.add({\n\t\tname: \"Set [number]\",\n\t\ttype: \"math/set\",\n\t\ttags: [\"math\", \"action\"],\n\t\tinit: \"Set {id:'varname', type:'variableName', variableType:'number'} to {id:'value', type:'number'}\",\n\t\tonact: function(my){\n\t\t\tvar _variables = my.target._variables;\n\t\t\tvar varname = my.data.varname; // it's just a synchronized string\n\t\t\t_variables[varname] = my.data.value; // Set the variable\n\t\t}\n\t});\n\n\t/****************\n\n\tDo math on some variable\n\n\t****************/\n\tJoy.add({\n\t\n\t\tname: \"Do math to [number]\",\n\t\ttype: \"math/operation\",\n\t\ttags: [\"math\", \"action\"],\n\n\t\tinit: JSON.stringify({\n\t\t\tid:'operation', type:'choose',\n\t\t\tplaceholder: \"+\",\n\t\t\toptions:[\n\t\t\t\t{ label:\"+ Increase\", value:\"+\" },\n\t\t\t\t{ label:\"- Decrease\", value:\"-\" },\n\t\t\t\t{ label:\"&times; Multiply\", value:\"*\" },\n\t\t\t\t{ label:\"&divide; Divide\", value:\"/\" }\n\t\t\t]\n\t\t})+\" {id:'varname', type:'variableName', variableType:'number', startWithExisting:true}\"\n\t\t+\" by {id:'value', type:'number'}\",\n\n\t\tonact: function(my){\n\n\t\t\tvar vars = my.target._variables;\n\t\t\tvar varname = my.data.varname;\n\t\t\tif(vars[varname]===undefined) vars[varname]=0; // Set to 0, if nothing's there.\n\n\t\t\tswitch(my.data.operation){\n\t\t\t\tcase \"+\": vars[varname] += my.data.value; break;\n\t\t\t\tcase \"-\": vars[varname] -= my.data.value; break;\n\t\t\t\tcase \"*\": vars[varname] *= my.data.value; break;\n\t\t\t\tcase \"/\": vars[varname] /= my.data.value; break;\n\t\t\t}\n\n\t\t}\n\n\t});\n\n\t/****************\n\n\tIf then... for math\n\n\t****************/\n\tJoy.add({\n\t\tname: \"If [math] then...\",\n\t\ttype: \"math/if\",\n\t\ttags: [\"math\", \"action\"],\n\t\tinit: \"If {id:'value1', type:'number'} \"+\n\t\t\t  \"{id:'test', type:'choose', options:['<','≤','=','≥','>'], placeholder:'='} \"+\n\t\t\t  \"{id:'value2', type:'number'}, then: \"+\n\t\t\t  \"{id:'actions', type:'actions', resetVariables:false}\",\n\t\tonact: function(my){\n\n\t\t\tvar value1 = my.data.value1;\n\t\t\tvar value2 = my.data.value2;\n\n\t\t\tvar result;\n\t\t\tswitch(my.data.test){\n\t\t\t\tcase '<': \n\t\t\t\t\tresult = value1<value2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase '≤': \n\t\t\t\t\tresult = value1<=value2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase '=': \n\t\t\t\t\tresult = value1==value2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase '≥': \n\t\t\t\t\tresult = value1>=value2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase '>':\n\t\t\t\t\tresult = value1>value2;\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif(result){\n\t\t\t\tvar message = my.actor.actions.act(my.target);\n\t\t\t\tif(message==\"STOP\") return message; // STOP\n\t\t\t}\n\n\t\t}\n\t});\n\n});\nJoy.module(\"random\", function(){\n\n\tJoy.add({\n\t\tname: \"With a X% chance...\",\n\t\ttype: \"random/if\",\n\t\ttags: [\"random\", \"action\"],\n\t\tinit: \"With a {id:'chance', type:'number', min:0, max:100, placeholder:50}% chance, do:\"+\n\t\t\t  \"{id:'actions', type:'actions', resetVariables:false}\",\n\t\tonact: function(my){\n\t\t\t\n\t\t\tvar probability = my.data.chance/100;\n\t\t\tif(Math.random() < probability){\n\t\t\t\tvar message = my.actor.actions.act(my.target);\n\t\t\t\tif(message==\"STOP\") return message; // STOP\n\t\t\t}\n\n\t\t}\n\t});\n\n\t/****************\n\n\tSet a variable to some number.\n\n\t****************/\n\tJoy.add({\n\t\tname: \"Set random [number]\",\n\t\ttype: \"random/set\",\n\t\ttags: [\"random\", \"action\"],\n\t\tinit: \"Set {id:'varname', type:'variableName', variableType:'number'} to a random \"+\n\t\t\t  \"{id:'numtype', type:'choose', options:['number','integer'], placeholder:'number'} between \"+\n\t\t\t  \"{id:'min', type:'number', placeholder:1} and {id:'max', type:'number', placeholder:100}\",\n\t\tonact: function(my){\n\n\t\t\tvar _variables = my.target._variables;\n\t\t\tvar varname = my.data.varname; // it's just a synchronized string\n\n\t\t\tvar _min = my.data.min;\n\t\t\tvar _max = my.data.max;\n\t\t\tvar min = Math.min(_min,_max); // just in case\n\t\t\tvar max = Math.max(_min,_max); // just in case\n\n\t\t\tvar randomValue;\n\t\t\tif(my.data.numtype==\"integer\"){\n\t\t\t\trandomValue = min + Math.floor( Math.random()*((max-min)+1) );\n\t\t\t}else{\n\t\t\t\trandomValue = min + (Math.random()*(max-min));\n\t\t\t}\n\t\t\t_variables[varname] = randomValue; // Set the variable\n\n\t\t}\n\t});\n\n});\n\nexport default Joy;","import Joy from '../libraries/joy.js';\n\nwindow.addEventListener('load', e => {\n\tconst effectList = [\n\t\t{\n\t\t\tname: 'solid fill',\n\t\t\tdropdownName: 'Solid Fill',\n\t\t\tcategory: 'Backgrounds',\n\t\t\tinit: \"Fill with {id:'color', type:'color', placeholder:[50, 0.8, 1.0]} and {id: 'whatever', type:'list'}\",\n\t\t\tcursor: './assets/cursors/fill-drip-solid.svg',\n\t\t\tmouseActionType: 'single-click',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.addFill(my.data.color);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: 'gradient',\n\t\t\tdropdownName: 'Gradient',\n\t\t\tcategory: 'Backgrounds',\n\t\t\tinit: \"Gradient from {id:'color1', type:'color', placeholder:[50, 0.8, 1.0]} to {id:'color2', type:'color', placeholder:[100, 0.8, 1.0]}\",\n\t\t\tcursor: './assets/cursors/fill-drip-solid.svg',\n\t\t\tmouseActionType: 'single-click',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.gradient(my.data.color1, my.data.color2);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: 'stripes',\n\t\t\tdropdownName: 'Stripes',\n\t\t\tcategory: 'Backgrounds',\n\t\t\tinit: `Stripes {id:'something', type:'motif/solid fill'} of width {id:'stripeWidth', type:'number', min:1, max:300, placeholder:50}\n\t\t\t\tfrom {id:'color1', type:'color', placeholder:[0, 0.7, 0.8]} \n\t\t\t\tto {id:'color2', type:'color', placeholder:[200, 0.7, 0.9]}`,\n\t\t\tcursor: './assets/cursors/fill-drip-solid.svg',\n\t\t\tmouseActionType: 'single-click',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.stripes(my.data.stripeWidth, my.data.color1, my.data.color2);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: 'circle',\n\t\t\tdropdownName: 'Circle',\n\t\t\tcategory: 'Shapes',\n\t\t\tinit: `Circle of radius {id:'radius', type:'number', min:1, max:600, placeholder:20} in color {id:'color', type:'color', placeholder:[20, 0.8, 1.0]}  \n\t\t\tat ({id:'x', type:'number', placeholder:200}, {id:'y', type:'number', placeholder:200})`,\n\t\t\tcursor: './assets/cursors/star-solid.svg',\n\t\t\tmouseActionType: 'single-click',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.addCircle(my.data.color, my.data.x, my.data.y, my.data.radius);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: 'square',\n\t\t\tdropdownName: 'Square',\n\t\t\tcategory: 'Shapes',\n\t\t\tinit: `Square of size {id:'size', type:'number', min:1, max:600, placeholder:40} in color {id:'color', type:'color', placeholder:[20, 0.8, 1.0]}  \n\t\t\tat ({id:'x', type:'number', placeholder:200}, {id:'y', type:'number', placeholder:200})`,\n\t\t\tcursor: './assets/cursors/star-solid.svg',\n\t\t\tmouseActionType: 'single-click',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.addSquare(my.data.color, my.data.x, my.data.y, my.data.size);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: 'polygon',\n\t\t\tdropdownName: 'Polygon',\n\t\t\tcategory: 'Shapes',\n\t\t\tinit: `Polygon with {id:'nsides', type:'number', placeholder:6} sides and radius {id:'radius', type:'number', placeholder:20} in color {id:'color', type:'color', placeholder:[20, 0.8, 1.0]}  \n\t\t\tat ({id:'x', type:'number', placeholder:200}, {id:'y', type:'number', placeholder:200})`,\n\t\t\tcursor: './assets/cursors/star-solid.svg',\n\t\t\tmouseActionType: 'single-click',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.polygon(my.data.color, my.data.x, my.data.y, my.data.radius, my.data.nsides);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: 'star',\n\t\t\tdropdownName: 'Star',\n\t\t\tcategory: 'Shapes',\n\t\t\tinit: `Star with {id:'npoints', type:'number', placeholder:7} points, outer {id:'r1', type:'number', placeholder:20}, inner {id:'r2', type:'number', placeholder:10} in color {id:'color', type:'color', placeholder:[20, 0.8, 1.0]}  \n\t\t\tat ({id:'x', type:'number', placeholder:200}, {id:'y', type:'number', placeholder:200})`,\n\t\t\tcursor: './assets/cursors/star-solid.svg',\n\t\t\tmouseActionType: 'single-click',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.star(my.data.color, my.data.x, my.data.y, my.data.r1, my.data.r2, my.data.npoints);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: 'heart',\n\t\t\tdropdownName: 'Heart',\n\t\t\tcategory: 'Shapes',\n\t\t\tinit: `Heart of size {id:'size', type:'number', placeholder:40} in color {id:'color', type:'color', placeholder:[20, 0.8, 1.0]}  \n\t\t\tat ({id:'x', type:'number', placeholder:200}, {id:'y', type:'number', placeholder:200})`,\n\t\t\tcursor: './assets/cursors/star-solid.svg',\n\t\t\tmouseActionType: 'single-click',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.heart(my.data.color, my.data.x, my.data.y, my.data.size);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: 'straight line',\n\t\t\tdropdownName: 'straight line',\n\t\t\tcategory: 'Brushes',\n\t\t\tinit: `Straight line from ({id:'x1', type:'number', placeholder:100}, {id:'y1', type:'number', placeholder:100})\n\t\t\tto ({id:'x2', type:'number', placeholder:200}, {id:'y2', type:'number', placeholder:200})\n\t\t\tin color {id:'color', type:'color', placeholder:[20, 0.8, 1.0]}\n\t\t\twith width {id: 'lineWidth', type: 'number', placeholder: 5}`,\n\t\t\tcursor: './assets/cursors/star-solid.svg',\n\t\t\tmouseActionType: 'drag',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.addLine(my.data.color, my.data.lineWidth, my.data.x1, my.data.y1, my.data.x2, my.data.y2, my.data.radius);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: 'brush',\n\t\t\tdropdownName: 'Brush',\n\t\t\tcategory: 'Brushes',\n\t\t\tinit: `Brush in {id:'color', type:'color', placeholder:[20, 0.8, 1.0]} with width {id: 'lineWidth', type: 'number', placeholder: 8} along path {id:'pointsList', type:'string', placeholder:'20,50,200,250'}`,\n\t\t\tcursor: './assets/cursors/star-solid.svg',\n\t\t\tmouseActionType: 'drag',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.addBrushStroke(my.data.color, my.data.lineWidth, my.data.pointsList);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: 'rainbow brush',\n\t\t\tdropdownName: 'Rainbow Brush',\n\t\t\tcategory: 'Brushes',\n\t\t\tinit: `Rainbow brush with points {id:'pointsList', type:'string', placeholder:'20,50,200,250'}`,\n\t\t\tcursor: './assets/cursors/star-solid.svg',\n\t\t\tmouseActionType: 'drag',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.addBrushStroke(my.data.pointsList);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: 'swirl',\n\t\t\tdropdownName: 'Swirl',\n\t\t\tcategory: 'Effects',\n\t\t\tinit: `Add swirl of radius {id:'radius', type:'number', placeholder:20} in color {id:'color', type:'color', placeholder:[20, 0.8, 1.0]}  \n\t\t\tat ({id:'x', type:'number', placeholder:200}, {id:'y', type:'number', placeholder:200})`,\n\t\t\tcursor: './assets/cursors/star-solid.svg',\n\t\t\tmouseActionType: 'single-click',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.addCircle(my.data.color, my.data.x, my.data.y, my.data.radius);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: 'invert',\n\t\t\tdropdownName: 'Invert',\n\t\t\tcategory: 'Effects',\n\t\t\tinit: `Color shift of type {id:'filter', type:'choose', options:['invert','threshold', 'gray', 'dilate', 'blur'], placeholder:'invert'}`,\n\t\t\tcursor: './assets/cursors/star-solid.svg',\n\t\t\tmouseActionType: 'single-click',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.applyFilter(my.data.filter);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: 'grayscale',\n\t\t\tdropdownName: 'Grayscale',\n\t\t\tcategory: 'Effects',\n\t\t\tinit: `Color shift of type {id:'filter', type:'choose', options:['invert','threshold', 'gray', 'dilate', 'blur'], placeholder:'gray'}`,\n\t\t\tcursor: './assets/cursors/star-solid.svg',\n\t\t\tmouseActionType: 'single-click',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.applyFilter(my.data.filter);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: 'threshold',\n\t\t\tdropdownName: 'Threshold',\n\t\t\tcategory: 'Effects',\n\t\t\tinit: `Color shift of type {id:'filter', type:'choose', options:['invert','threshold', 'gray', 'dilate', 'blur'], placeholder:'threshold'}`,\n\t\t\tcursor: './assets/cursors/star-solid.svg',\n\t\t\tmouseActionType: 'single-click',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.applyFilter(my.data.filter);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\tname: 'grid',\n\t\t\tdropdownName: 'grid',\n\t\t\tcategory: 'Patterns',\n\t\t\tinit: `Repeat in grid with rows and columns`,\n\t\t\tcursor: './assets/cursors/star-solid.svg',\n\t\t\tmouseActionType: 'single-click',\n\t\t\tonact: (my) => {\n\t\t\t\tmy.target.addCircle(my.data.color, my.data.x, my.data.y, my.data.radius);\n\t\t\t}\n\t\t},\n\t]\n\n\tconst app = new MotifApp(effectList);\n});\n\nclass MotifApp {\n\tconstructor(effectList) {\n\t\tthis.effects = this.reindex(effectList, 'name');\n\t\tthis.sketch = this.initP5();\n\t\tthis.sketch.addFill('#aaaaaa');\n\t\tthis.sketch.clear('#aaaaaa');\n\t\tthis.joy = this.initJoy();\n\t\tthis.initUI();\n\n\t\tthis.joy.actions.addAction('stencils/paperdoll', undefined, {});\n\t\tthis.joy.actions.update();\n\n\t\t//TODO: add global effect settings such as line weight, color, etc to pass into current events that have a \"preview\"\n\t}\n\n\tinitP5() {\n\t\treturn new p5(s => {\n\t\t\t\n\t\t\tlet points = null;\n\t\t\tlet strokeColor = 0;\n\t\t\tlet strokeWeight = 5;\n\n\t\t\ts.setup = () => {\n\t\t\t  s.createCanvas(600, 600);\n\t\t\t  s.background(255);\n\t\t\t  s.setupFinished = true;\n\t\t\t  s.noLoop();\n\t\t\t};\n\t\t  \n\t\t\ts.draw = () => {\n\t\t\t\tif(points) {\n\t\t\t\t\tpoints.renderLine(s, strokeColor, strokeWeight); //TODO: rethink this way of passing in preview line settings\n\t\t\t\t}\n\t\t\t};\n\t\t\n\t\t\ts.clear = () => {\n\t\t\t\tif(!s.setupFinished) return;\n\t\t\t\ts.background(255);\n\t\t\t}\n\t\t\n\t\t\ts.addCircle = (color, x, y, r) => {\n\t\t\t\tif(!s.setupFinished) return;\n\t\t\t\ts.fill(color);\n\t\t\t\ts.noStroke();\n\t\t\t\ts.circle(x, y, r*2);\n\t\t\t}\n\n\t\t\ts.addSquare = (color, x, y, size) => {\n\t\t\t\ts.push();\n\t\t\t\ts.rectMode(s.CENTER);\n\t\t\t\ts.fill(color);\n\t\t\t\ts.noStroke();\n\t\t\t\ts.rect(x, y, size, size);\n\t\t\t\ts.pop();\n\t\t\t}\n\t\t\n\t\t\ts.addFill = (color) => {\n\t\t\t\tif(!s.setupFinished) return;\n\t\t\t\ts.fill(color);\n\t\t\t\ts.noStroke();\n\t\t\t\ts.rect(0, 0, s.width, s.height);\n\t\t\t}\n\n\t\t\ts.star = (color, x, y, r1, r2, npoints) => {\n\t\t\t\tif(!s.setupFinished) return;\n\t\t\t\tlet angle = s.TWO_PI / npoints;\n\t\t\t\tlet halfAngle = angle / 2.0;\n\t\t\t\ts.fill(color);\n\t\t\t\ts.noStroke();\n\t\t\t\ts.beginShape();\n\t\t\t\tfor (let a = 0; a < s.TWO_PI; a += angle) {\n\t\t\t\t  let sx = x + s.cos(a) * r2;\n\t\t\t\t  let sy = y + s.sin(a) * r2;\n\t\t\t\t  s.vertex(sx, sy);\n\t\t\t\t  sx = x + s.cos(a + halfAngle) * r1;\n\t\t\t\t  sy = y + s.sin(a + halfAngle) * r1;\n\t\t\t\t  s.vertex(sx, sy);\n\t\t\t\t}\n\t\t\t\ts.endShape(s.CLOSE);\n\t\t\t}\n\n\t\t\ts.polygon = (color, x, y, r, nsides) => {\n\t\t\t\tif(!s.setupFinished) return;\n\t\t\t\tnsides = Math.abs(nsides);\n\t\t\t\ts.fill(color);\n\t\t\t\ts.noStroke();\n\t\t\t\tlet angle = s.TWO_PI / nsides;\n\t\t\t\ts.beginShape();\n\t\t\t\tfor (let a = 0; a < s.TWO_PI; a += angle) {\n\t\t\t\t  let sx = x + s.cos(a) * r;\n\t\t\t\t  let sy = y + s.sin(a) * r;\n\t\t\t\t  s.vertex(sx, sy);\n\t\t\t\t}\n\t\t\t\ts.endShape(s.CLOSE);\n\t\t\t}\n\n\t\t\ts.gradient = (color1, color2) => {\n\t\t\t\tif(!s.setupFinished) return;\n\t\t\t\tlet pcolor1 = s.color(color1);\n\t\t\t\tlet pcolor2 = s.color(color2);\n\t\t\t\ts.noFill();\n\t\t\t\ts.strokeWeight(1);\n\t\t\t\tfor(let i=0;i<s.height;i++) {\n\t\t\t\t\ts.stroke(s.lerpColor(pcolor1, pcolor2, i/s.height));\n\t\t\t\t\ts.line(0, i, s.width, i);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ts.stripes = (stripeWidth, color1, color2) => {\n\t\t\t\tif(!s.setupFinished) return;\n\t\t\t\ts.push();\n\t\t\t\ts.translate(0, stripeWidth/2); //so that top stripe is fully shown\n\t\t\t\tlet pcolor1 = s.color(color1);\n\t\t\t\tlet pcolor2 = s.color(color2);\n\t\t\t\ts.noFill();\n\t\t\t\ts.strokeWeight(stripeWidth);\n\t\t\t\tfor(let i=0;i<s.height;i+=stripeWidth) {\n\t\t\t\t\tlet c = s.lerpColor(pcolor1, pcolor2, i/(s.height-stripeWidth));\n\t\t\t\t\tconsole.log(c);\n\t\t\t\t\ts.stroke(c);\n\t\t\t\t\ts.line(0, i, s.width, i);\n\t\t\t\t}\n\t\t\t\ts.pop();\n\t\t\t}\n\n\t\t\t//by Mithru: https://editor.p5js.org/Mithru/sketches/Hk1N1mMQg\n\t\t\ts.heart = (color, x, y, size) => {\n\t\t\t\tif(!s.setupFinished) return;\n\t\t\t\ts.push();\n\t\t\t\ts.translate(0, -size/2);\n\t\t\t\ts.fill(color);\n\t\t\t\ts.noStroke();\n\t\t\t\ts.beginShape();\n\t\t\t\ts.vertex(x, y);\n\t\t\t\ts.bezierVertex(x - size / 2, y - size / 2, x - size, y + size / 3, x, y + size);\n\t\t\t\ts.bezierVertex(x + size, y + size / 3, x + size / 2, y - size / 2, x, y);\n\t\t\t\ts.endShape(s.CLOSE);\n\t\t\t\ts.pop();\n\t\t\t}\n\n\t\t\ts.applyFilter = (filter) => {\n\t\t\t\ts.filter(s[filter.toUpperCase()]);\n\t\t\t}\n\n\t\t\ts.stencil = (name, params) => {\n\n\t\t\t}\n\n\t\t\t// s.setStrokeColor = (color) => {\n\t\t\t// \tstrokeColor = color;\n\t\t\t// }\n\n\t\t\t// s.setStrokeWeight = (weight) => {\n\t\t\t// \tstrokeWeight = weight;\n\t\t\t// }\n\n\t\t\ts.startPoints = (x, y) => {\n\t\t\t\tpoints = new DrawnLine(x, y);\n\t\t\t\tconsole.log(\"inside start points function\", points);\n\t\t\t\ts.loop();\n\t\t\t}\n\n\t\t\ts.addPoint = (x, y) => {\n\t\t\t\tpoints.addPoint(x, y);\n\t\t\t}\n\n\t\t\ts.endPoints = () => {\n\t\t\t\tpoints = null;\n\t\t\t\ts.noLoop();\n\t\t\t}\n\n\t\t\ts.getPoint = (index) => {\n\t\t\t\treturn points.points[index];\n\t\t\t}\n\n\t\t\ts.getLastPoint = () => {\n\t\t\t\treturn points.points[points.points.length-1];\n\t\t\t}\n\n\t\t\ts.pointsAsString = () => {\n\t\t\t\treturn points.toString();\n\t\t\t}\n\n\t\t\ts.mouseDragged = () => {\n\t\t\t\tif(points) {\n\t\t\t\t\ts.addPoint(s.mouseX, s.mouseY);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ts.addLine = (color, lineWeight, x1, y1, x2, y2) => {\n\t\t\t\tif(!s.setupFinished) return;\n\t\t\t\ts.strokeWeight(lineWeight);\n\t\t\t\ts.noFill();\n\t\t\t\ts.stroke(color);\n\t\t\t\ts.line(x1, y1, x2, y2);\n\t\t\t}\n\n\t\t\ts.addBrushStroke = (color, lineWeight, pointsString) => {\n\t\t\t\tif(!s.setupFinished) return;\n\t\t\t\ts.push();\n\t\t\t\ts.noFill();\n\t\t\t\ts.strokeWeight(lineWeight);\n\t\t\t\ts.stroke(color);\n\t\t\t\ts.strokeJoin(s.ROUND);\n\t\t\t\t\n\t\t\t\tlet points = pointsString.split(',');\n\t\t\t\ts.beginShape();\n\t\t\t\tfor(let i=0;i<points.length-1;i+=2) {\n\t\t\t\t\ts.vertex(points[i], points[i+1]);\n\t\t\t\t}\n\t\t\t\ts.endShape();\n\t\t\t\ts.pop();\n\t\t\t}\n\n\t\t  }, 'drawing-canvas');\n\t}\n\t\n\tinitUI() {\n\t\tthis.categories = [...new Set(Object.values(this.effects).map(a => a.category))]; //get unique categories from effect list\n\t\tlet categoryToolbar = document.getElementsByClassName('category-toolbar')[0];\n\t\tlet drawingToolbar = document.getElementsByClassName('drawing-toolbar')[0];\n\t\tthis.categories.forEach((c) => {\n\t\t\t// Create a button for the category and add it to the toolbar\n\t\t\tlet categoryButton = this.createButton(c, c, ['category-button']);\n\t\t\tcategoryToolbar.appendChild(categoryButton);\n\t\t\t\n\t\t\t// Create a div to hold the buttons that belong to this category. Hide all to start\n\t\t\tlet drawingTools = this.createDiv(c + '-buttons', [c + '-buttons', 'category-drawing-tools']);\n\t\t\tdrawingToolbar.appendChild(drawingTools);\n\t\t\tdrawingTools.classList.add('hidden');\n\n\t\t\t// Create effect buttons and add them to their category div\n\t\t\tlet effectsInCategory = Object.values(this.effects).filter(effect => effect.category === c);\n\t\t\tlet effectNames = effectsInCategory.map(a => a.name);\n\t\t\teffectNames.forEach(name => {\n\t\t\t\tlet effectButton = this.createButton(name, name + '-button', ['effect-button']);\n\t\t\t\tdrawingTools.appendChild(effectButton);\n\t\t\t\teffectButton.addEventListener('click', (event) => {\n\t\t\t\t\tthis.markSelectedById('effect-button', name + '-button'); //TODO: get self ID?\n\t\t\t\t\t//this.updateCursor(this.effects[name].cursor); //TODO\n\t\t\t\t});\n\t\t\t});\n\t\t\t\n\t\t\t// When category button is clicked, mark it selected and show the div containing its effect buttons\n\t\t\tcategoryButton.addEventListener(\"click\", (e) => {\n\t\t\t\tthis.markSelectedById(\"category-button\", e.target.id);\n\t\t\t\tdocument.getElementsByClassName('category-drawing-tools').forEach(element => {\n\t\t\t\t\telement.classList.add('hidden');\n\t\t\t\t});\n\t\t\t\tdrawingTools.classList.remove('hidden');\n\t\t\t\tthis.markSelectedById(\"effect-button\", drawingTools.firstChild.id);\n\t\t\t});\n\t\t});\n\n\t\t//Mouse event listeners\n\n\t\tlet dragging = false;\n\t\tlet mouseDownOverCanvas = false; //TODO: doesn't work if you leave canvas with mouse down\n\n\t\tdocument.getElementById('drawing-canvas').addEventListener('mousedown', e => {\n\t\t\tdragging = false;\n\t\t\tmouseDownOverCanvas = true;\n\n\t\t\tlet activeEffect = this.getSelectedEffect();\n\t\t\tif(activeEffect) {\n\t\t\t\tif(this.effects[activeEffect].mouseActionType == 'drag') {\n\t\t\t\t\tthis.sketch.set\n\t\t\t\t\tthis.sketch.startPoints(this.sketch.mouseX, this.sketch.mouseY);\n\t\t\t\t} else {\n\t\t\t\t\tthis.addEvent(activeEffect, {\n\t\t\t\t\t\t\tx: { type:'number', value: Math.round(this.sketch.mouseX)},\n\t\t\t\t\t\t\ty: { type:'number', value: Math.round(this.sketch.mouseY)}\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tdocument.getElementById('drawing-canvas').addEventListener('mousemove', e => {\n\t\t\tif(mouseDownOverCanvas) {\n\t\t\t\tdragging = true;\n\t\t\t}\n\t\t});\n\n\t\tdocument.getElementById('drawing-canvas').addEventListener('mouseup', e => {\n\t\t\t// console.log(drag ? 'drag' : 'click');\n\t\t\tmouseDownOverCanvas = false;\n\n\t\t\tlet activeEffect = this.getSelectedEffect();\n\t\t\tif(activeEffect) {\n\t\t\t\tif(this.effects[activeEffect].mouseActionType == 'drag') {\n\t\t\t\t\tthis.sketch.addPoint(this.sketch.mouseX, this.sketch.mouseY);\n\t\t\t\t\tif(activeEffect == 'straight line') {\n\t\t\t\t\t\tthis.addEvent(activeEffect, {\n\t\t\t\t\t\t\tx1: { type:'number', value: Math.round(this.sketch.getPoint(0).x) },\n\t\t\t\t\t\t\ty1: { type:'number', value: Math.round(this.sketch.getPoint(0).y) },\n\t\t\t\t\t\t\tx2: { type:'number', value: Math.round(this.sketch.getLastPoint().x) },\n\t\t\t\t\t\t\ty2: { type:'number', value: Math.round(this.sketch.getLastPoint().y) },\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse if(activeEffect == 'brush') {\n\t\t\t\t\t\tthis.addEvent(activeEffect, { pointsList: { type:'number', value: this.sketch.pointsAsString()} });\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tthis.sketch.endPoints();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t}\n\n\taddEvent(effectName, settings) {\n\t\tlet effect = this.effects[effectName];\n\n\t\tsettings.color = { type:'color', value:[Math.random()*360, 0.8, 0.8]};\n\t\t\n\t\t// let hexColor = document.getElementById('color-picker').value;\n\t\t// let hslColor = _rgbToHsl(_hexToRgb(hexColor));\n\n\t\t//TODO: make this match effect params\n\t\t// let params = ...settings;\n\t\t\n\t\t// {\n\t\t// \t// color: { type:'color', value:[50, 0.5, 1.0]},\n\t\t// \t// color: { type:'color', value:[hslColor[0], hslColor[1], hslColor[2]]},\n\t\t// \tcolor: { type:'color', value:[Math.random()*360, 0.8, 0.8]},\n\t\t// \tx: { type:'number', value: Math.round(settings.x)},\n\t\t// \ty: {type:'number', value: Math.round(settings.y)},\n\t\t// \tx1: { type:'number', value: Math.round(settings.x1)},\n\t\t// \ty1: {type:'number', value: Math.round(settings.y1)},\n\t\t// \tx2: { type:'number', value: Math.round(settings.x2)},\n\t\t// \ty2: {type:'number', value: Math.round(settings.y2)}\n\t\t// }\n\t\tthis.joy.actions.addAction('motif/'+effectName, undefined, settings);\n\t\tthis.joy.actions.update();\n\t}\n\n\tgetSelectedEffect() {\n\t\tlet selectedEffects = document.querySelectorAll('.effect-button.selected:not(.hidden)')\n\t\tif(selectedEffects.length > 0) {\n\t\t  let selectedEffect = selectedEffects[0];\n\t\t  return selectedEffect.value;\n\t\t} else return \"\";\n\t}\n\n\tmarkSelectedById(className, id) {\n\t\tdocument.getElementsByClassName(className).forEach(element => {\n\t\t  element.classList.remove('selected');\n\t\t});\n\t\tdocument.getElementById(id).classList.add('selected');\n\t}\n\n\tcreateButton(name, id, classNames) {\n\t\tlet b = document.createElement(\"input\");\n\t\tb.setAttribute(\"type\", \"button\");\n\t\tclassNames.forEach((className) => {\n\t\t\tb.classList.add(className);\n\t\t});\n\t\tb.setAttribute(\"value\", name);\n\t\tb.setAttribute(\"id\", id);\n\t\treturn b;\n\t}\n\n\tcreateDiv(id, classNames) {\n\t\tlet div = document.createElement(\"div\");\n\t\tclassNames.forEach((className) => {\n\t\t\tdiv.classList.add(className);\n\t\t});\n\t\tdiv.setAttribute(\"id\", id);\n\t\treturn div;\n\t}\n\n\treindex(list, key) {\n\t\tlet dict = { };\n\t\tlist.forEach((item) => {\n\t\t\tdict[item[key]] = item;\n\t\t});\n\t\treturn dict;\n\t}\n\n\tinitJoy() {\n\t\tlet data = Joy.loadFromURL();\n\t\tlet sketch = this.sketch;\n\t\tlet effects = this.effects;\n\n\t\tJoy.module(\"motif\", function() {\n\n\t\t\t//Add from effects list\n\t\t\tObject.values(effects).forEach(effect => {\n\t\t\t\tconsole.log(effect);\n\t\t\t\tJoy.add({\n\t\t\t\t\tname: effect.dropdownName,\n\t\t\t\t\ttype: \"motif/\" + effect.name,\n\t\t\t\t\ttags: [\"motif\", \"action\"],\n\t\t\t\t\tinit: effect.init,\n\t\t\t\t\tonact: effect.onact\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\tJoy.module(\"stencils\", function() {\n\t\t\tJoy.add({\n\t\t\t\tname: \"Paper Doll\",\n\t\t\t\ttype: \"stencils/paperdoll\",\n\t\t\t\ttags: [\"stencils\", \"action\"],\n\t\t\t\n\t\t\t\t// What the action does is EMBEDDED IN A PLAIN-LANGUAGE SENTENCE\n\t\t\t\tinit: \"Use stencil paper doll with clothing {id:'outfit', type:'choose', options:['dress','pants','shirt'], placeholder:'dress'}\",\n\t\t\t\n\t\t\t\t// Callback\n\t\t\t\tonact: function(my){\n\t\t\t\t\tmy.target.stencil('paperdoll', my.data.outfit);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\n\t\t// {\n\t\t// \tname: 'paper doll',\n\t\t// \tdropdownName: 'Paper doll',\n\t\t// \tcategory: 'Stencils',\n\t\t// \tinit: `Paper doll with radius {id:'radius', type:'number', placeholder:20} in color {id:'color', type:'color', placeholder:[20, 0.8, 1.0]}  \n\t\t// \tat ({id:'x', type:'number', placeholder:200}, {id:'y', type:'number', placeholder:200})`,\n\t\t// \tcursor: './assets/cursors/star-solid.svg',\n\t\t// \tonact: (my) => {\n\t\t// \t\tmy.target.addCircle(my.data.color, my.data.x, my.data.y, my.data.radius);\n\t\t// \t}\n\t\t// },\n\t\t// {\n\t\t// \tname: 'box',\n\t\t// \tdropdownName: 'Box',\n\t\t// \tcategory: 'Stencils',\n\t\t// \tinit: `Box with radius {id:'radius', type:'number', placeholder:20} in color {id:'color', type:'color', placeholder:[20, 0.8, 1.0]}  \n\t\t// \tat ({id:'x', type:'number', placeholder:200}, {id:'y', type:'number', placeholder:200})`,\n\t\t// \tcursor: './assets/cursors/star-solid.svg',\n\t\t// \tonact: (my) => {\n\t\t// \t\tmy.target.addCircle(my.data.color, my.data.x, my.data.y, my.data.radius);\n\t\t// \t}\n\t\t// },\n\n\t\tJoy.add({\n\t\t\ttype: \"list\",\n\t\t\ttags: [\"ui\"],\n\t\t\tinitWidget: function(self){\n\t\t\t\tself.dom = document.createElement(\"div\");\n\t\t\t\tself.dom.innerHTML = \"hello i am a list i promise\";\n\t\t\t},\n\t\t\tonget: function(my){\n\t\t\t\treturn 3;\n\t\t\t},\n\t\t});\n\n\n\n\t\tlet joy = Joy({\n\t\t\t// Where the Joy editor goes:\n\t\t\tcontainer: \"#joy\",\n\t\t\n\t\t\t// The words and widgets inside the editor:\n\t\t\tinit: \"To create my design: \"+\n\t\t\t\t  \"{id:'actions', type:'actions'} \"+ // a list of actions\n\t\t\t\t//   \"Fill with {id:'color', type:'color', placeholder:[0.3, 0.8, 1.0]}\" +\n\t\t\t\t  \"<hr> {type:'save'}\", // a save button!\n\t\t\t\n\t\t\t// Load data from URL, otherwise blank:\n\t\t\tdata: data,\n\t\t\n\t\t\t// Actions to include:\n\t\t\tmodules: [\"motif\", \"instructions\", \"stencils\", \"math\"], //TODO: 'math' module removes min and max settings on Scrubber - see line 1032 and 2813\n\t\t\n\t\t\tpreviewActions: true,\n\t\t\tpreviewNumbers: true,\n\t\t\n\t\t\t// What to do when the user makes a change:\n\t\t\tonupdate: function(my) {\n\t\t\t\tsketch.clear();\n\t\t\t\tmy.actions.act(sketch);\n\t\t\t}\n\t\t});\n\n\t\treturn joy;\n\t}\n}\n\nlet _rgbToHsl = rgb => {\n\t// const [r, g, b] = rgbStr.slice(4, -1).split(',').map(Number);\n\tconst [r, g, b] = Object.values(rgb);\n\tconst max = Math.max(r, g, b)\n\tconst min = Math.min(r, g, b)\n\tconst l = Math.floor((max + min) / ((0xff * 2) / 100))\n  \n\tif (max === min) return [0, 0, l / 100]\n\tconst d = max - min\n\tconst s = Math.floor((d / (l > 50 ? 0xff * 2 - max - min : max + min)) * 100)\n  \n\tif (max === r) return [Math.floor(((g - b) / d + (g < b && 6)) * 60), s / 100, l / 100]\n\treturn max === g\n\t  ? [Math.floor(((b - r) / d + 2) * 60), s / 100, l / 100]\n\t  : [Math.floor(((r - g) / d + 4) * 60), s / 100, l / 100]\n}\n\n\n/* https://gist.github.com/mjackson/5311256 by kigiri*/\nlet _rgbStrToHsl = rgbStr => {\n\tconst [r, g, b] = rgbStr.slice(4, -1).split(',').map(Number)\n\tconst max = Math.max(r, g, b)\n\tconst min = Math.min(r, g, b)\n\tconst l = Math.floor((max + min) / ((0xff * 2) / 100))\n\t\n\tif (max === min) return [0, 0, l]\n\tconst d = max - min\n\tconst s = Math.floor((d / (l > 50 ? 0xff * 2 - max - min : max + min)) * 100)\n\t\n\tif (max === r) return [Math.floor(((g - b) / d + (g < b && 6)) * 60), s, l]\n\treturn max === g\n\t\t? [Math.floor(((b - r) / d + 2) * 60), s, l]\n\t\t: [Math.floor(((r - g) / d + 4) * 60), s, l]\n}\n\n/* https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb */\nlet _hexToRgb = hex => {\n\t// Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n\tvar shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n\thex = hex.replace(shorthandRegex, function(m, r, g, b) {\n\t\treturn r + r + g + g + b + b;\n\t});\n\t\n\tvar result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n\treturn result ? {\n\t\tr: parseInt(result[1], 16),\n\t\tg: parseInt(result[2], 16),\n\t\tb: parseInt(result[3], 16)\n\t} : null;\n}\n\n\nclass DrawnLine {\n\tconstructor(x, y) {\n\t\tthis.points = [];\n\t\tthis.addPoint(x, y);\n\t}\n\t\n\taddPoint(x, y) {\n\t\tthis.points.push({ x: x, y: y });\n\t}\n\n\ttoString() {\n\t\tlet a = [];\n\t\tthis.points.forEach(p => {\n\t\t\ta.push(Math.round(p.x));\n\t\t\ta.push(Math.round(p.y));\n\t\t});\n\t\treturn a.toString();\n\t}\n\t\n\trenderPoints(s) {\n\t\ts.push();\n\t\ts.strokeWeight(5);\n\t\ts.noFill();\n\t\ts.stroke(0);\n\t\tthis.points.forEach(p => {\n\t\t\ts.point(p.x, p.y);\n\t\t});\n\t\ts.pop();\n\t}\n\n\trenderLine(s, strokeColor, strokeWeight) {\n\t\ts.push();\n\t\ts.strokeWeight(strokeWeight);\n\t\ts.stroke(strokeColor);\n\t\ts.noFill();\n\t\ts.beginShape();\n\t\tthis.points.forEach(p => {\n\t\t\ts.vertex(p.x, p.y);\n\t\t});\n\t\ts.endShape();\n\t\ts.pop();\n\t}\n}"],"names":["Joy","options","self","modules","i","length","loadModule","Actor","call","initReferences","undefined","previewActions","previewNumbers","activePreview","canPreview","type","charAt","toUpperCase","slice","createWidget","container","document","body","querySelector","appendChild","dom","ui","init","modal","onupdate","my","update","actor","data","children","forEach","childActor","dataID","value","get","child","id","parent","data1","this","_class_","top","actorTemplate","getTemplateByType","_configure","addChild","push","removeChild","_removeFromArray","kill","onkill","parentNode","unwatch","_onDataChange","placeholder","Array","isArray","_clone","getData","setData","newValue","noUpdate","_myEditLock","setTimeout","switchData","newData","watch","onDataChange","attr","op","oldValue","initWidget","createElement","innerHTML","previewData","onact","act","target","altData","onget","initializeWithString","templates","add","template","template1","find","Error","getTemplatesByTag","tag","filter","tags","indexOf","modify","rename","callback","arguments","newTemplate","_old","modifications","markup","actorOptions","html","startIndex","endIndex","stack","character","json","replace","JSON","parse","substr","actorOption","selector","span","replaceChild","module","topdata","_references","connected","createReference","reference","_generateUID","_forceToArray","getReferenceById","refID","getReferencesByTag","refs","ref","connectReference","disconnectReference","deleteReference","saveToURL","stringify","compressed","LZString","compressToEncodedURIComponent","window","location","origin","pathname","loadFromURL","hash","_getParameterByName","decompressed","decompressFromEncodedURIComponent","Math","TAU","PI","config","key","array","toDelete","index","splice","_preventWeirdCopyPaste","element","addEventListener","e","preventDefault","clipboardData","text","execCommand","sel","range","getSelection","getRangeAt","rangeCount","deleteContents","insertNode","createTextNode","selection","createRange","_insertTextAtCursor","_selectAll","input","collapseToEnd","selectNodeContents","collapse","removeAllRanges","addRange","_unselectAll","_fixStringInput","innerText","search","obj","num","thing","name","url","href","results","RegExp","exec","decodeURIComponent","_HSVtoRGB","h","s","v","r","g","b","f","p","q","t","floor","round","_HSVToRGBString","rgb","_randomHSVIndex","_randomHSVArray","exports","x","w","a","a1","noMore","useDirtyCheck","b1","c1","d1","e1","Object","defineProperty","a2","f1","toString","h1","prototype","i1","apply","j1","c","d","hasOwnProperty","added","removed","k1","constructor","l1","a3","observe","a4","object","set","enumerable","configurable","__defineGetter__","__defineSetter__","n1","m1","writable","prop","orig","o1","q1","D","R","u","I","a5","String","y","z","A","C","B","c2","d2","j","splices","deleteCount","addedCount","deleted","oldvalue","d3","f2","g1","watchers","H","N","k","l","m","n","__watchall__","concat","j3","k2","o","K","L","E","F","G","S","T","J","__wjs_suspend__","M","mode","newval","oldval","O","P","actual","watcher","level","Q","setInterval","callWatchers","suspend","onChange","o2","t1","r1","fromCharCode","n2","e2","i3","compressToBase64","o3","_compress","decompressFromBase64","_decompress","compressToUTF16","o4","decompressFromUTF16","charCodeAt","compressToUint8Array","compress","Uint8Array","decompressFromUint8Array","o5","decompress","join","o6","o7","pow","val","position","define","amd","master","classList","event","delta","deltaY","scrollTop","keyCode","doPrevent","srcElement","getAttribute","isContentEditable","tagName","toLowerCase","Button","className","label","setLabel","newLabel","onclick","styles","ChooserButton","onchange","staticLabel","Chooser","source","_updateLabel","pair","Scrubber","min","max","toFixed","sigfigs","lastDragX","startDragValue","_onValueChange","parseFloat","isDragging","wasDragging","_onmousedown","clientX","onstart","_onmousemove","step","toPrecision","velocity","multiplier","abs","dx","_boundNumber","_onmouseup","onstop","removeEventListener","_manuallyEditing","onblur","contentEditable","_countSigFigs","_parseNumber","which","blur","spellcheck","oninput","regex","match","isNaN","string","positionOfPeriod","prefixDOM","suffixDOM","prefix","suffix","onfocus","onkeypress","setString","setColor","color","_forceToRGB","style","borderColor","TextBox","multiline","readonly","setAttribute","select","width","getValue","setValue","height","scrollHeight","bg","currentUI","box","show","display","boxBounds","getBoundingClientRect","sourceBounds","clientHeight","left","onopen","hide","node","hasChildNodes","lastChild","_emptyDOM","onclose","list","categories","_placeholder_","_makeCategory","category","categoryDOM","populate","option1","optionDOM","option","stopPropagation","Color","FULL_WIDTH","FULL_HEIGHT","wheelCanvas","wheelContext","getContext","WHEEL_SIZE","MARGIN_1","_updateWheel","ctx","clearRect","canvas","image","createImageData","imageData","cx","cy","radius","radiusBuffered","dy","distance","sqrt","angle","atan2","putImageData","save","globalCompositeOperation","beginPath","fillStyle","arc","fill","restore","spectrumCanvas","spectrumContext","SPECTRUM_WIDTH","right","MARGIN_3","_updateSpectrum","pickerCanvas","pickerContext","editMode","_updatePickers","strokeStyle","lineWidth","cos","sin","stroke","MARGIN_2","_update","offsetX","offsetY","_updateHS","_updateV","_updateSource","scrubber","_ticker","onmouseenter","_amplitude","_timer","_stopPreview","clearInterval","onmouseleave","colorButton","_changeLabelColor","hsl","background","_vel","random","chooserButton","stringUI","saveButton","info","resetVariables","actions","bulletOptions","_createBullet","entry","bullet","_getBulletLabel","choice","newActionWhere","newEntryIndex","entries","actionOptions","_addAction","_updateBullets","actionData","_onBulletChoice","levelsDeep","_numberToAlphabet","NaN","digits","split","roman","pop","_numberToRoman","_addEntry","atIndex","entryDOM","insertBefore","bulletContainer","newActor","newWidget","widget","_previewAction","_previewStyle","_calculatePreviewParam","param","_PREVIEW","actionIndex","STOP","head","sheet","insertRule","onmousemove","remove","i4","actorType","newAction","addAction","onlyActions","actionType","notActionTag","actionActors","actionActor","addButton","_variables","actorMessage","loops","count","message","variableType","_createNewReference","hsv","varnames","highestCount","refData","map","varname","parseInt","refID1","varReferences","startWithExisting","_switchReference","newRefID","refID2","stringActor","stringWidget","_old_stringActor_onDataChange","noChooser","myRefID","newColor","oldRefID","noVariables","originalValue","_makeNewChainActor","chainItem","chainActor","chainActors","chain","realChain","chain1","_replaceChainActor","oldChainActor","newItem","oldIndex","_deleteChainActor","newChainActor","_chainEntries","_makeChainEntry","ca","_mouseDownTime","moreButton","_showChainOptions","childNodes","beforeThisWidget","Date","placeholderNumber","_replaceChainEntry","_showChooser","_deleteChainEntry","entry1","currentLabel","elementIndex","operandIndex","operandLabel","indicesToDelete","sort","operand","operandActor","numberActor","indices","indexToDelete","actorToDelete","i5","chainActor1","nums_and_ops","num1","num2","res","vars","operation","result","value1","value2","test","probability","chance","randomValue","_min","_max","numtype","$f2e71c8f74100de5$export$2e2bcd8739ae039","$kQXSw","parcelRequire","$24e87f2b64c7c1bd$var$MotifApp","dropdownName","cursor","mouseActionType","addFill","gradient","color1","color2","stripes","stripeWidth","addCircle","addSquare","size","polygon","nsides","star","r2","npoints","heart","addLine","x1","y1","x2","y2","addBrushStroke","pointsList","applyFilter","effectList","effects","reindex","sketch","initP5","clear","joy","initJoy","initUI","p5","points1","setup","createCanvas","setupFinished","noLoop","draw","renderLine","noStroke","circle","rectMode","CENTER","rect","TWO_PI","halfAngle","beginShape","sx","sy","vertex","endShape","CLOSE","pcolor1","pcolor2","noFill","strokeWeight","lerpColor","line","translate","console","log","bezierVertex","stencil","params","startPoints","$24e87f2b64c7c1bd$var$DrawnLine","loop","addPoint","endPoints","getPoint","points","getLastPoint","pointsAsString","mouseDragged","mouseX","mouseY","lineWeight","pointsString","strokeJoin","ROUND","Set","values","categoryToolbar","getElementsByClassName","drawingToolbar","categoryButton","createButton","drawingTools","createDiv","effect","effectButton","markSelectedById","firstChild","dragging","mouseDownOverCanvas","getElementById","activeEffect","getSelectedEffect","addEvent","effectName","settings","selectedEffects","querySelectorAll","classNames","div","dict","item","default","outfit","renderPoints","point","strokeColor"],"version":3,"file":"index.811a8eb3.js.map"}